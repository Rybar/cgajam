<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Game Zero ES6</title><style>
body{margin:0;overflow:hidden;background:#111;color:#ccc}#canvas{position:absolute;top:0;bottom:0;left:0;right:0;width:100%;height:100%;image-rendering:optimizeSpeed;image-rendering:-moz-crisp-edges;image-rendering:-webkit-optimize-contrast;image-rendering:-o-crisp-edges;image-rendering:pixelated;-ms-interpolation-mode:nearest-neighbor;cursor:none;margin:auto}
</style></head><body><canvas id="canvas"></canvas><script>
var GAME=function(){function t(e){return Math.sin(6.283184*e)}function n(e){return 0>t(e)?-1:1}function r(e){return e%1-.5}function i(e){var t=e%1*4;return 2>t?t-1:3-t}function a(e){return.00390625*Math.pow(1.059463094,e-128)}function s(e,t){setTimeout(function(){var n=new Uint8Array(e*h*2),r=n.length-2,i=function(){for(var e=new Date,a=0;r>=0;)if(n[r]=0,n[r+1]=128,r-=2,(a+=1)%1e3==0&&new Date-e>d)return void setTimeout(i,0);setTimeout(function(){t(n)},0)};setTimeout(i,0)},0)}function o(e,t,n,r,i){var a=n.fx_delay_time*r>>1,s=n.fx_delay_amt/255,o=0,c=function(){for(var n=new Date,r=0;t-a>o;){var l=4*o,h=4*(o+a),u=e[h]+(e[h+1]<<8)+(e[l+2]+(e[l+3]<<8)-32768)*s;if(e[h]=255&u,e[h+1]=u>>8&255,u=e[h+2]+(e[h+3]<<8)+(e[l]+(e[l+1]<<8)-32768)*s,e[h+2]=255&u,e[h+3]=u>>8&255,++o,(r+=1)%1e3==0&&new Date-n>d)return void setTimeout(c,0)}setTimeout(i,0)};setTimeout(c,0)}function c(){stats.begin();let e=(new Date).getTime();p.dt=Math.min(1,(e-p.last)/1e3),p.game.step(p.dt),p.last=e,p.game.render(),stats.end(),requestAnimationFrame(c)}ENGINE={E:this,screen:0,page1:65536,page2:131072,page3:196608,page4:262144,page5:327680,page6:393216,page7:458752,TRANSPARENT:0,BLACK:1,MAGENTA:2,CYAN:3,WHITE:4,colors:[4278190080,4278190080,4294923775,4294967125,4294967295],palDefault:[0,1,2,3,4],pal:[0,1,2,3,4],renderTarget:0,renderSource:65536,currentState:0,playSound:function(e,t,n,r){var i=u.createBufferSource(),a=u.createGain(),s=u.createStereoPanner();return i.buffer=e,i.connect(s),s.connect(a),a.connect(u.destination),i.playbackRate.value=t,i.loop=r,a.gain.value=1,s.pan.value=n,i.start(),{volume:a,sound:i}},gfx:{clear:function(e){p.ram.fill(e,p.renderTarget,p.renderTarget+65536)},pset:function(e,t,n){t|=0,(e|=0)>-1&&256>e&&t>-1&&256>t&&(p.ram[p.renderTarget+(256*t+e)]=n)},line:function(e,t,n,r,i){var a,s,o=(r|=0)-(t|=0),c=(n|=0)-(e|=0);if(0>o?(o=-o,s=-1):s=1,0>c?(c=-c,a=-1):a=1,o<<=1,c<<=1,this.pset(e,t,i),c>o)for(var l=o-(c>>1);e!=n;)0>l||(t+=s,l-=c),e+=a,l+=o,this.pset(e,t,i);else for(l=c-(o>>1);t!=r;)0>l||(e+=a,l-=o),t+=s,l+=c,this.pset(e,t,i)},circle:function(e,t,n,r){var i=-n,a=0,s=2-2*n;do{this.pset(e-i,t+a,r),this.pset(e-a,t-i,r),this.pset(e+i,t-a,r),this.pset(e+a,t+i,r),(n=s)>a||(s+=2*++a+1),(n>i||s>a)&&(s+=2*++i+1)}while(0>i)},fillCircle:function(e,t,n,r){e|=0,t|=0,r|=0;var i=-(n|=0),a=0,s=2-2*n;do{this.line(e-i,t-a,e+i,t-a,r),this.line(e-i,t+a,e+i,t+a,r),(n=s)>a||(s+=2*++a+1),(n>i||s>a)&&(s+=2*++i+1)}while(0>i)},rect:function(e,t,n,r,i){e|=0,n|=0,t|=0,r|=0,this.line(e,t,n,t,i),this.line(n,t,n,r,i),this.line(e,r,n,r,i),this.line(e,t,e,r,i)},fillRect:function(e,t,n,r,i){e|=0,n|=0,t|=0,r|=0;var a=Math.abs(r-t);if(p.gfx.line(e,t,n,t,i),a>0)for(;--a;)p.gfx.line(e,t+a,n,t+a,i);p.gfx.line(e,r,n,r,i)},triangle:function(e,t,n,r,i,a,s){p.gfx.line(e,t,n,r,s),p.gfx.line(n,r,i,a,s),p.gfx.line(i,a,e,t,s)},fillTriangle:function(e,t,n,r,i,a,s){var e=Math.round(16*e),n=Math.round(16*n),i=Math.round(16*i),t=Math.round(16*t),o=e-n,c=(r=Math.round(16*r))-t,l=n-i,h=(a=Math.round(16*a))-r,d=i-e,u=t-a,f=Math.max(Math.min(e,n,i)+15>>4,0),y=Math.min(Math.max(e,n,i)+15>>4,256),g=Math.max(Math.min(t,r,a)+15>>4,0),x=Math.min(Math.max(t,r,a)+15>>4,256);f&=-8,g&=-8;var v=-c*e-o*t,m=-h*n-l*r,w=-u*i-d*a;(c>0||0==c&&o>0)&&v++,(h>0||0==h&&l>0)&&m++,(u>0||0==u&&d>0)&&w++,v=v-1>>4,m=m-1>>4,w=w-1>>4;var _=0,M=0,S=0,T=0,A=0,C=0;0>o?_-=7*o:M-=7*o,0>c?_-=7*c:M-=7*c,0>l?S-=7*l:T-=7*l,0>h?S-=7*h:T-=7*h,0>d?A-=7*d:C-=7*d,0>u?A-=7*u:C-=7*u;for(var D=g;x>D;D+=8)for(var G=f;y>G;G+=8){var E=v+o*D+c*G,b=m+l*D+h*G,R=w+d*D+u*G;if(!(M>E||T>b||C>R)){var I=G+256*D;if(E<_||b<S||R<A)for(B=0;8>B;B++){for(var k=E,z=b,L=R,K=0;8>K;K++)0>(k|z|L)||(p.ram[p.renderTarget+I]=s),k+=c,z+=h,L+=u,I++;E+=o,b+=l,R+=d,I+=248}else for(var B=0;8>B;B++){for(K=0;8>K;K++,I++)p.ram[p.renderTarget+I]=s;I+=248}}}},spr:function(e=0,t=0,n=16,r=16,i=0,a=0,s=!1,o=!1){for(var c=0;r>c;c++)for(var l=0;n>l;l++)255>a+c&&255>i+l&&a+c>-1&&i+l>-1&&(s&o?p.ram[p.renderSource+(256*(t+(r-c))+e+(n-l))]>0&&(p.ram[p.renderTarget+(256*(a+c)+i+l)]=p.pal[p.ram[p.renderSource+(256*(t+(r-c))+e+(n-l))]]):o&&!s?p.ram[p.renderSource+(256*(t+(r-c))+e+l)]>0&&(p.ram[p.renderTarget+(256*(a+c)+i+l)]=p.ram[p.renderSource+(256*(t+(r-c))+e+l)]):s&&!o?p.ram[p.renderSource+(256*(t+c)+e+(n-l))]>0&&(p.ram[p.renderTarget+(256*(a+c)+i+l)]=p.ram[p.renderSource+(256*(t+c)+e+(n-l))]):s||o||p.ram[p.renderSource+(256*(t+c)+e+l)]>0&&(p.ram[p.renderTarget+(256*(a+c)+i+l)]=p.pal[p.ram[p.renderSource+(256*(t+c)+e+l)]]))},sspr:function(e=0,t=0,n=16,r=16,i=0,a=0,s=16,o=16,c=!1,l=!1){for(var h=n/s,d=r/o,u=0;o>u;u++)for(var f=0;s>f;f++)px=f*h|0,py=u*d|0,255>a+u&&255>i+f&&a+u>-1&&i+f>-1&&p.ram[p.renderSource+(256*(t+py)+e+px)]>0&&(p.ram[p.renderTarget+(256*(a+u)+i+f)]=p.ram[p.renderSource+(256*(t+py)+e+px)])},checker:function(e,t,n){var r=256,i=256,a=0,s=0;e=e||8,r/=t=t||8,i/=e;for(var o=0;e>o;++o)for(var c=0,l=t/2;l>c;++c)a=2*c*r+(o%2?0:r),s=o*i,p.gfx.fillRect(a,s,a+r,s+i,n)}},canvasInit:function(){p.canvas=document.getElementById("canvas"),p.ctx=canvas.getContext("2d"),p.canvas.width=window.innerWidth,p.canvas.height=window.innerHeight,p.ctx.imageSmoothingEnabled=!1,p.ctx.mozImageSmoothingEnabled=!1,p.smallcanvas=document.createElement("canvas"),p.smallctx=p.smallcanvas.getContext("2d"),p.smallcanvas.width=256,p.smallcanvas.height=256,p.canvasHeight=p.smallcanvas.height,p.canvasWidth=p.smallcanvas.width,p.imageData=p.smallctx.getImageData(0,0,p.canvasWidth,p.canvasHeight),p.buf=new ArrayBuffer(p.imageData.data.length),p.buf8=new Uint8ClampedArray(p.buf),p.data=new Uint32Array(p.buf),p.ram=new Uint8ClampedArray(524288),p.renderTarget=p.screen},render:function(){for(var e=65536;e--;)p.data[e]=p.colors[p.pal[p.ram[e]]];p.imageData.data.set(p.buf8),p.smallctx.putImageData(p.imageData,0,0),p.compositeSize=window.innerWidth<window.innerHeight?window.innerWidth:window.innerHeight,p.compositeOrigin=(window.innerWidth-p.compositeSize)/2|0,p.ctx.imageSmoothingEnabled=!1,p.ctx.mozImageSmoothingEnabled=!1,p.ctx.drawImage(p.smallcanvas,0,0,255,255,p.compositeOrigin,0,p.compositeSize,p.compositeSize)}};p=ENGINE;Number.prototype.map=function(e,t,n,r){return(this-e)*(r-n)/(t-e)+n},p.assets={song:{rowLen:5513,endPattern:2,songData:[{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:192,osc1_waveform:1,osc2_oct:6,osc2_det:0,osc2_detune:9,osc2_xenv:0,osc2_vol:192,osc2_waveform:1,noise_fader:0,env_attack:137,env_sustain:2e3,env_release:4611,env_master:192,fx_filter:1,fx_freq:982,fx_resonance:89,fx_delay_time:6,fx_delay_amt:25,fx_pan_freq:6,fx_pan_amt:77,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:3,lfo_amt:69,lfo_waveform:0,p:[1],c:[{n:[135,0,0,0,147,0,0,145,0,0,147,0,0,142,0,0,135,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]}],songLen:9},letters:{"-":[[,,,,0],[,,,,0],[1,1,1,1,1],[,,,,0],[,,,,0]],".":[[,,,,0],[,,,,0],[,,,,0],[,,,,0],[,,1,,0]],1:[[,1,1,,0],[,,1,,0],[,,1,,0],[,,1,,0],[1,1,1,1,1]],2:[[1,1,1,1,0],[,,,,1],[,1,1,1,0],[1,,,,0],[1,1,1,1,1]],3:[[1,1,1,1,0],[,,,,1],[,1,1,1,1],[,,,,1],[1,1,1,1,0]],4:[[1,,,1,0],[1,,,1,0],[1,1,1,1,1],[,,,1,0],[,,,1,0]],5:[[1,1,1,1,1],[1,,,,0],[1,1,1,1,0],[,,,,1],[1,1,1,1,0]],6:[[,1,1,1,0],[1,,,,0],[1,1,1,1,0],[1,,,,1],[,1,1,1,0]],7:[[1,1,1,1,1],[,,,,1],[,,,1,0],[,,1,,0],[,,1,,0]],8:[[,1,1,1,0],[1,,,,1],[,1,1,1,0],[1,,,,1],[,1,1,1,0]],9:[[,1,1,1,0],[1,,,,1],[,1,1,1,1],[,,,,1],[,1,1,1,0]],0:[[,1,1,1,0],[1,,,,1],[1,,,,1],[1,,,,1],[,1,1,1,0]],A:[[1,1,1,1,1],[1,,,,1],[1,1,1,1,1],[1,,,,1],[1,,,,1]],B:[[1,1,1,1,0],[1,,,1,0],[1,1,1,1,1],[1,,,,1],[1,1,1,1,1]],C:[[1,1,1,1,1],[1,,,,0],[1,,,,0],[1,,,,0],[1,1,1,1,1]],D:[[1,1,1,,0],[1,,,1,0],[1,,,,1],[1,,,,1],[1,1,1,1,1]],E:[[1,1,1,1,1],[1,,,,0],[1,1,1,,0],[1,,,,0],[1,1,1,1,1]],F:[[1,1,1,1,1],[1,,,,0],[1,1,1,,0],[1,,,,0],[1,,,,0]],G:[[1,1,1,1,1],[1,,,,0],[1,,1,1,1],[1,,,,1],[1,1,1,1,1]],H:[[1,,,,1],[1,,,,1],[1,1,1,1,1],[1,,,,1],[1,,,,1]],I:[[1,1,1,1,1],[,,1,,0],[,,1,,0],[,,1,,0],[1,1,1,1,1]],J:[[,,,,1],[,,,,1],[,,,,1],[1,,,,1],[1,1,1,1,1]],K:[[1,,,1,0],[1,,1,,0],[1,1,1,,0],[1,,,1,0],[1,,,,1]],L:[[1,,,,0],[1,,,,0],[1,,,,0],[1,,,,0],[1,1,1,1,1]],M:[[1,,,,1],[1,1,,1,1],[1,,1,,1],[1,,,,1],[1,,,,1]],N:[[1,,,,1],[1,1,,,1],[1,,1,,1],[1,,,1,1],[1,,,,1]],O:[[1,1,1,1,1],[1,,,,1],[1,,,,1],[1,,,,1],[1,1,1,1,1]],P:[[1,1,1,1,1],[1,,,,1],[1,1,1,1,1],[1,,,,0],[1,,,,0]],Q:[[1,1,1,1,0],[1,,,1,0],[1,,,1,0],[1,,,1,0],[1,1,1,1,1]],R:[[1,1,1,1,1],[1,,,,1],[1,1,1,1,1],[1,,,1,0],[1,,,,1]],S:[[1,1,1,1,1],[1,,,,0],[1,1,1,1,1],[,,,,1],[1,1,1,1,1]],T:[[1,1,1,1,1],[,,1,,0],[,,1,,0],[,,1,,0],[,,1,,0]],U:[[1,,,,1],[1,,,,1],[1,,,,1],[1,,,,1],[1,1,1,1,1]],V:[[1,,,,1],[1,,,,1],[1,,,,1],[,1,,1,0],[,,1,,0]],W:[[1,,,,1],[1,,,,1],[1,,1,,1],[1,1,,1,1],[1,,,,1]],X:[[1,,,,1],[,1,,1,0],[,,1,,0],[,1,,1,0],[1,,,,1]],Y:[[1,,,,1],[1,,,,1],[1,1,1,1,1],[,,1,,0],[,,1,,0]],Z:[[1,1,1,1,1],[,,,1,0],[,,1,,0],[,1,,,0],[1,1,1,1,1]]," ":[[,,,,0],[,,,,0],[,,,,0],[,,,,0],[,,,,0]],",":[[,,,,0],[,,,,0],[,,,,0],[,,1,,0],[,,1,,0]],"+":[[,,,,0],[,,1,,0],[,1,1,1,0],[,,1,,0],[,,,,0]],"/":[[,,,,1],[,,,1,0],[,,1,,0],[,1,,,0],[1,,,,0]],":":[[,,,,0],[,,1,,0],[,,,,0],[,,1,,0],[,,,,0]],"@":[[1,1,1,1,1],[,,,,1],[1,1,1,,1],[1,,1,,1],[1,1,1,1,1]],x:[[1,,1,,1],[,1,,1,0],[1,,1,,1],[,1,,1,0],[1,,1,,1]],z:[[,1,,1,0],[1,,1,,1],[,1,,1,0],[1,,1,,1],[,1,,1,0]],o:[[1,1,1,1,1],[1,,,,1],[1,,1,,1],[1,,,,1],[1,1,1,1,1]],e:[[1,,,,0],[1,1,,,0],[1,1,1,,0],[1,1,1,1,0],[1,1,1,1,1]],w:[[,,,,1],[,,,1,1],[,,1,1,1],[,1,1,1,1],[1,1,1,1,1]],s:[[1,1,1,1,1],[,1,1,1,1],[,,1,1,1],[,,,1,1],[,,,,1]],d:[[1,1,1,1,1],[1,1,1,1,0],[1,1,1,,0],[1,1,,,0],[1,,,,0]],t:[[0,0,0,1,1],[0,0,1,1,1],[0,0,1,1,1],[0,0,1,1,1],[0,0,1,1,1]],y:[[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1]],u:[[1,1,0,0,0],[1,1,1,0,0],[0,0,1,0,0],[0,1,1,0,0],[1,1,1,0,0]],g:[[0,0,1,1,1],[0,0,0,1,1],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,1]],h:[[1,1,1,1,1],[1,1,1,1,1],[0,1,1,1,0],[1,1,1,1,1],[1,1,1,1,1]],j:[[1,1,1,0,0],[1,1,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[1,1,1,1,1]],b:[[0,0,0,1,1],[0,0,0,1,1],[0,0,0,0,1],[0,0,0,0,1],[0,0,0,0,1]],n:[[1,1,1,1,1],[1,1,1,1,1],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],m:[[1,1,1,1,1],[1,0,0,1,1],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0]]}},Entity=function(e){e||(e={radius:10,gravity:0,frictX:.92,frictY:.94}),this.cx=0,this.cy=0,this.xr=0,this.yr=0,this.xx=0,this.yy=0,this.dx=0,this.dy=0,this.collided=!1,this.ox=0,this.oy=0,this.radius=e.radius||10,this.gravity=e.gravity||0,this.bounce=e.bounce||0,this.frictX=e.frictX||.92,this.frictY=e.frictY||.94,this.dead=!1,this.collides=e.collides||0,this.mapcollide=e.mapcollide||0,this.id=Math.random()},Entity.prototype.setCoords=function(e,t){this.xx=e,this.yy=t,this.cx=Math.floor(this.xx/Const.GRID),this.cy=Math.floor(this.yy/Const.GRID),this.xr=(this.xx-this.cx*Const.GRID)/Const.GRID,this.yr=(this.yy-this.cy*Const.GRID)/Const.GRID},Entity.prototype.hasCollision=function(e,t){return!!this.mapcollide&&(void 0!=Assets.map[t]&&void 0!=Assets.map[t][e]&&Assets.map[t][e])},Entity.prototype.overlaps=function(e,t){var n=e.radius+t.radius;return(t.xx-e.xx)*(t.xx-e.xx)+(t.yy-e.yy)*(t.yy-e.yy)<=n*n},Entity.prototype.onGround=function(){return this.hasCollision(this.cx,this.cy+1)&&this.yr>=.5},Entity.prototype.onCeiling=function(){return this.hasCollision(this.cx,this.cy-1)&&.5>=this.yr},Entity.prototype.onWallLeft=function(){return this.hasCollision(this.cx-1,this.cy)&&.5>=this.xr},Entity.prototype.onWallRight=function(){return this.hasCollision(this.cx+1,this.cy)&&this.xr>=.5},Entity.prototype.update=function(){for(this.xr+=this.dx,this.dx*=this.frictX,this.hasCollision(this.cx-1,this.cy)&&.3>=this.xr&&(this.dx=0,this.xr=.3),this.hasCollision(this.cx+1,this.cy)&&this.xr>=.7&&(this.dx=0,this.xr=.7);0>this.xr;)this.cx--,this.xr++;for(;this.xr>1;)this.cx++,this.xr--;for(this.dy+=this.gravity,this.yr+=this.dy,this.dy*=this.frictY,this.hasCollision(this.cx,this.cy-1)&&.4>=this.yr&&(this.dy=0,this.yr=.4),this.hasCollision(this.cx,this.cy+1)&&this.yr>=.7&&(this.dy=this.bounce?-this.dy:0,this.bounce||(this.yr=.7));0>this.yr;)this.cy--,this.yr++;for(;this.yr>1;)this.cy++,this.yr--;this.xx=Math.floor((this.cx+this.xr)*Const.GRID),this.yy=Math.floor((this.cy+this.yr)*Const.GRID),this.ox=(this.cx+this.xr)*Const.GRID,this.oy=(this.cy+this.yr)*Const.GRID},Entity.prototype.collide=function(t,n){var r=Math.sqrt((t.xx-n.xx)*(t.xx-n.xx)+(t.yy-n.yy)*(t.yy-n.yy));if(r<=t.radius+n.radius){this.collided=!0;var i=Math.atan2(t.yy-n.yy,t.xx-n.xx),a=(n.radius+t.radius-r)/(n.radius+t.radius);this.dx-=Math.cos(i)*a*.03,this.dy-=Math.sin(i)*a*.03,e.dx+=Math.cos(i)*a*.03,e.dy+=Math.sin(i)*a*.03}};var l={},h=2,d=33,u=null,f=[t,n,r,i];l.AudioGenerator=function(e){this.mixBuf=e,this.waveSize=e.length/h/2},l.AudioGenerator.prototype.getWave=function(){var e,t,n,r,i,a,s,o=this.mixBuf,c=this.waveSize*h*2;for(a=(i=c-8)-36,r=String.fromCharCode(82,73,70,70,255&i,i>>8&255,i>>16&255,i>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&a,a>>8&255,a>>16&255,a>>24&255),e=0;c>e;){for(n="",t=0;256>t&&c>e;++t,e+=2)s=-32768>(s=4*(o[e]+(o[e+1]<<8)-32768))?-32768:s>32767?32767:s,n+=String.fromCharCode(255&s,s>>8&255);r+=n}return r},l.AudioGenerator.prototype.getAudio=function(){var e=this.getWave(),t=new Audio("data:audio/wav;base64,"+btoa(e));return t.preload="none",t.load(),t},l.AudioGenerator.prototype.getAudioBuffer=function(e){null===u&&(u=new AudioContext);var t=this.mixBuf,n=this.waveSize*h*2,r=u.createBuffer(h,this.waveSize,44100),i=r.getChannelData(0),a=r.getChannelData(1),s=0,o=function(){for(var c=new Date,l=0;n/2>s;){var h=4*(t[4*s]+(t[4*s+1]<<8)-32768);if(h=-32768>h?-32768:h>32767?32767:h,i[s]=h/32768,h=4*(t[4*s+2]+(t[4*s+3]<<8)-32768),h=-32768>h?-32768:h>32767?32767:h,a[s]=h/32768,s+=1,(l+=1)%1e3==0&&new Date-c>d)return void setTimeout(o,0)}setTimeout(function(){e(r)},0)};setTimeout(o,0)},l.SoundGenerator=function(e,t){this.instr=e,this.rowLen=t||5605,this.osc_lfo=f[e.lfo_waveform],this.osc1=f[e.osc1_waveform],this.osc2=f[e.osc2_waveform],this.attack=e.env_attack,this.sustain=e.env_sustain,this.release=e.env_release,this.panFreq=Math.pow(2,e.fx_pan_freq-8)/this.rowLen,this.lfoFreq=Math.pow(2,e.lfo_freq-8)/this.rowLen},l.SoundGenerator.prototype.genSound=function(e,n,r){new Date;for(var i=0,s=0,o=a(e+12*(this.instr.osc1_oct-8)+this.instr.osc1_det)*(1+8e-4*this.instr.osc1_detune),c=a(e+12*(this.instr.osc2_oct-8)+this.instr.osc2_det)*(1+8e-4*this.instr.osc2_detune),l=this.instr.fx_resonance/255,h=0,d=0,u=this.attack+this.sustain+this.release-1;u>=0;--u){var f=u+r,y=this.osc_lfo(f*this.lfoFreq)*this.instr.lfo_amt/512+.5,p=1;u<this.attack?p=u/this.attack:u<this.attack+this.sustain||(p-=(u-this.attack-this.sustain)/this.release);var g=o;this.instr.lfo_osc1_freq&&(g+=y),this.instr.osc1_xenv&&(g*=p*p),i+=g;var x=this.osc1(i)*this.instr.osc1_vol;g=c,this.instr.osc2_xenv&&(g*=p*p),s+=g,x+=this.osc2(s)*this.instr.osc2_vol,this.instr.noise_fader&&(x+=(2*Math.random()-1)*this.instr.noise_fader*p),x*=p/255;var v=this.instr.fx_freq;this.instr.lfo_fx_freq&&(v*=y);var m=l*(x-d)-(h+=(v=1.5*Math.sin(3.141592*v/44100))*d);switch(d+=v*m,this.instr.fx_filter){case 1:x=m;break;case 2:x=h;break;case 3:x=d;break;case 4:x=h+m}if(g=t(f*this.panFreq)*this.instr.fx_pan_amt/512+.5,x*=39*this.instr.env_master,(f*=4)+3<n.length){var w=n[f]+(n[f+1]<<8)+x*(1-g);n[f]=255&w,n[f+1]=w>>8&255,w=n[f+2]+(n[f+3]<<8)+x*g,n[f+2]=255&w,n[f+3]=w>>8&255}}},l.SoundGenerator.prototype.getAudioGenerator=function(e,t){var n=this.attack+this.sustain+this.release-1+32*this.rowLen,r=this;s(n,function(i){r.genSound(e,i,0),o(i,n,r.instr,r.rowLen,function(){t(new l.AudioGenerator(i))})})},l.SoundGenerator.prototype.createAudio=function(e,t){this.getAudioGenerator(e,function(e){t(e.getAudio())})},l.SoundGenerator.prototype.createAudioBuffer=function(e,t){this.getAudioGenerator(e,function(e){e.getAudioBuffer(t)})},l.MusicGenerator=function(e){this.song=e,this.waveSize=44100*e.songLen},l.MusicGenerator.prototype.generateTrack=function(e,t,n){var r=this;s(this.waveSize,function(i){var a=r.waveSize,s=r.waveSize*h*2,c=r.song.rowLen,u=r.song.endPattern,f=new l.SoundGenerator(e,c),y=0,p=0,g=0,x=function(){for(var t=new Date;;)if(32!==g){if(p===u-1)return void setTimeout(v,0);var n=e.p[p];if(n){var r=e.c[n-1].n[g];r&&f.genSound(r,i,y)}if(y+=c,g+=1,new Date-t>d)return void setTimeout(x,0)}else g=0,p+=1},v=function(){o(i,a,e,c,w)},m=0,w=function(){for(var e=new Date,r=0;s>m;){var a=t[m]+(t[m+1]<<8)+i[m]+(i[m+1]<<8)-32768;if(t[m]=255&a,t[m+1]=a>>8&255,m+=2,(r+=1)%1e3==0&&new Date-e>d)return void setTimeout(w,0)}setTimeout(n,0)};setTimeout(x,0)})},l.MusicGenerator.prototype.getAudioGenerator=function(e){var t=this;s(this.waveSize,function(n){var r=0,i=function(){r<t.song.songData.length?(r+=1,t.generateTrack(t.song.songData[r-1],n,i)):e(new l.AudioGenerator(n))};i()})},l.MusicGenerator.prototype.createAudio=function(e){this.getAudioGenerator(function(t){e(t.getAudio())})},l.MusicGenerator.prototype.createAudioBuffer=function(e){this.getAudioGenerator(function(t){t.getAudioBuffer(e)})};var y=function(){function e(e){return r.appendChild(e.dom),e}function t(e){for(var t=0;t<r.children.length;t++)r.children[t].style.display=t===e?"block":"none";n=e}var n=0,r=document.createElement("div");r.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",r.addEventListener("click",function(e){e.preventDefault(),t(++n%r.children.length)},!1);var i=(performance||Date).now(),a=i,s=0,o=e(new y.Panel("FPS","#0ff","#002")),c=e(new y.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var l=e(new y.Panel("MB","#f08","#201"));return t(0),{REVISION:16,dom:r,addPanel:e,showPanel:t,begin:function(){i=(performance||Date).now()},end:function(){s++;var e=(performance||Date).now();if(c.update(e-i,200),e>a+1e3&&(o.update(1e3*s/(e-a),100),a=e,s=0,l)){var t=performance.memory;l.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){i=this.end()},domElement:r,setMode:t}};y.Panel=function(e,t,n){var r=1/0,i=0,a=Math.round,s=a(window.devicePixelRatio||1),o=80*s,c=48*s,l=3*s,h=2*s,d=3*s,u=15*s,f=74*s,y=30*s,p=document.createElement("canvas");p.width=o,p.height=c,p.style.cssText="width:80px;height:48px";var g=p.getContext("2d");return g.font="bold "+9*s+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=n,g.fillRect(0,0,o,c),g.fillStyle=t,g.fillText(e,l,h),g.fillRect(d,u,f,y),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(d,u,f,y),{dom:p,update:function(c,x){r=Math.min(r,c),i=Math.max(i,c),g.fillStyle=n,g.globalAlpha=1,g.fillRect(0,0,o,u),g.fillStyle=t,g.fillText(a(c)+" "+e+" ("+a(r)+"-"+a(i)+")",l,h),g.drawImage(p,d+s,u,f-s,y,d,u,f-s,y),g.fillRect(d+f-s,u,s,y),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(d+f-s,u,s,a((1-c/x)*y))}}},"object"==typeof module&&(module.exports=y),Key={_pressed:{},_released:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,a:65,w:87,s:83,d:68,z:90,x:88,f:70,p:80,r:82,isDown:function(e){return this._pressed[e]},justReleased:function(e){return this._released[e]},onKeydown:function(e){this._pressed[e.keyCode]=!0},onKeyup:function(e){this._released[e.keyCode]=!0,delete this._pressed[e.keyCode]},update:function(){this._released={}}},Txt={textLine:function(e){for(var t=e.text.length,n=0;t>n;n++)for(var r=p.assets.letters[e.text.charAt(n)]||p.assets.letters.unknown,i=0;5>i;i++)for(var a=0;5>a;a++)1===r[i][a]&&(1===e.scale?p.gfx.pset(e.x+a*e.scale+(5*e.scale+e.hspacing)*n,e.y+i*e.scale,e.color):p.gfx.fillRect(e.x+a*e.scale+(5*e.scale+e.hspacing)*n,e.y+i*e.scale,e.x+a*e.scale+(5*e.scale+e.hspacing)*n+e.scale,e.y+i*e.scale+e.scale,e.color))},text:function(e){var t=5*e.scale,n=e.text.split("\n"),r=n.slice(0),i=n.length,a=r.sort(function(e,t){return t.length-e.length})[0],s=a.length*t+(a.length-1)*e.hspacing,o=i*t+(i-1)*e.vspacing,c=e.x,l=e.y,h=e.x+s,d=e.y+o;"center"==e.halign?(c=e.x-s/2,h=e.x+s/2):"right"==e.halign&&(c=e.x-s,h=e.x),"center"==e.valign?(l=e.y-o/2,d=e.y+o/2):"bottom"==e.valign&&(l=e.y-o,d=e.y);var u=c+s/2,f=l+o/2;if(e.render)for(var y=0;i>y;y++){var p=n[y],g=p.length*t+(p.length-1)*e.hspacing,x=e.x,v=e.y+(t+e.vspacing)*y;"center"==e.halign?x=e.x-g/2:"right"==e.halign&&(x=e.x-g),"center"==e.valign?v-=o/2:"bottom"==e.valign&&(v-=o),e.snap&&(x=Math.floor(x),v=Math.floor(v)),this.textLine({ctx:e.ctx,x:x,y:v,text:p,hspacing:e.hspacing||0,scale:e.scale||1,color:e.color})}return{sx:c,sy:l,cx:u,cy:f,ex:h,ey:d,width:s,height:o}}},p.game={create:function(){p.sounds={},window.AudioContext=window.AudioContext||window.webkitAudioContext,u=new AudioContext,new l.MusicGenerator(p.assets.song).createAudioBuffer(function(e){p.sounds.song=e}),p.bullets=[];for(e=0;200>e;e++)p.bullets.push({x:-10,y:-10,xVel:0,yVel:0});p.triangles=[];for(var e=0;200>e;e++){let e=255*Math.random()|0,t=255*Math.random()|0,n=10*Math.random();p.triangles.push({x1:e+Math.random()*n*4-n,y1:t+Math.random()*n*4-n,x2:e+Math.random()*n*4-n,y2:t+Math.random()*n*4-n,x3:e+Math.random()*n*4-n,y3:t+Math.random()*n*4-n,color:1+(2*Math.random()|0),speed:n})}p.t=0,p.moveX=0,p.speedFactor=.2,p.songTrigger=!1,p.cursor={x:0,y:0}},resize:function(){p.canvas.width=window.innerWidth,p.canvas.height=window.innerHeight},step:function(e){p.t+=e,p.cos=Math.cos(e),p.sin=Math.sin(e);for(var t=0;t<p.triangles.length;t++){var n=p.triangles[t];n.y1+=n.speed*p.speedFactor,n.y2+=n.speed*p.speedFactor,n.y3+=n.speed*p.speedFactor,280>n.y1||(n.y1-=280,n.y2-=280,n.y3-=280)}p.player.update(e),Key.isDown(Key.z)&&(p.songTrigger=!0),p.songTrigger&&(p.songTrigger=!1,p.playSound(p.sounds.song,1,1,0))},render:function(e){p.renderTarget=p.page1,p.gfx.fillRect(0,0,256,256,0);for(t=0;t<p.triangles.length;t++)p.gfx.triangle(p.triangles[t].x1,p.triangles[t].y1,p.triangles[t].x2,p.triangles[t].y2,p.triangles[t].x3,p.triangles[t].y3,p.triangles[t].color);p.player.draw(),p.renderTarget=p.page3;for(var t=2e3;t--;){var n=256*Math.random()|0,r=256*Math.random()|0,i=p.ram[p.page1+(256*r+n)];p.gfx.circle(n,r+1,1,i-1)}p.renderTarget=p.page2,p.gfx.fillRect(0,0,256,256,0),Txt.text({x:8,y:240,text:"X: "+(""+p.player.x).substring(0,7)+"\nY: "+(""+p.player.y).substring(0,7),hspacing:2,vspacing:2,halign:"left",valign:"top",scale:1,snap:1,render:1,color:p.CYAN}),p.renderSource=p.page3,p.renderTarget=p.screen,p.gfx.fillRect(0,0,256,256,1),p.gfx.spr(0,0,256,256),p.renderSource=p.page1,p.renderTarget=p.screen,p.gfx.spr(0,0,256,256),p.renderSource=p.page2,p.renderTarget=p.screen,p.gfx.spr(0,0,256,256),p.render()}},p.player={x:128,y:230,radius:3,xvel:0,yvel:0,speed:6,drag:.97,x1:119,x2:137,x3:128,y1:239,y2:239,y3:221,update:function(e){let t=e*p.player.xvel*p.player.drag,n=e*p.player.yvel*p.player.drag;p.player.x+=t,p.player.y+=n,p.player.x1+=t,p.player.x2+=t,p.player.x3+=t,p.player.y1+=n,p.player.y2+=n,p.player.y3+=n,Key.isDown(Key.a)&&(p.player.xvel-=p.player.speed),Key.isDown(Key.d)&&(p.player.xvel+=p.player.speed),Key.isDown(Key.w)&&(p.player.yvel-=p.player.speed),Key.isDown(Key.s)&&(p.player.yvel+=p.player.speed),Key.isDown(Key.SPACE),p.player.x>256+2*p.player.radius&&(p.player.x=-p.player.radius),p.player.x<0-2*p.player.radius&&(p.player.x=256+p.player.radius),p.player.y>256+2*p.player.radius&&(p.player.y=-p.player.radius),p.player.y<0-2*p.player.radius&&(p.player.y=256+p.player.radius)},draw:function(e){p.gfx.fillTriangle(p.player.x1,p.player.y1,p.player.x2,p.player.y2,p.player.x3,p.player.y3,p.WHITE)}};var p=ENGINE;init=function(){p.last=0,p.dt=0,p.now=0,stats=new y,document.body.appendChild(stats.dom),p.canvasInit(),p.game.create(),window.addEventListener("keyup",function(e){Key.onKeyup(e)},!1),window.addEventListener("keydown",function(e){Key.onKeydown(e)},!1),window.addEventListener("blur",function(e){paused=!0},!1),window.addEventListener("focus",function(e){paused=!1},!1),window.addEventListener("resize",p.game.resize),c()},window.onload=init()}();
</script></body></html>