<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Game Zero ES6</title><style>
body{margin:0;overflow:hidden;background:#111;color:#ccc}#canvas{position:absolute;top:0;bottom:0;left:0;right:0;width:100%;height:100%;image-rendering:optimizeSpeed;image-rendering:-moz-crisp-edges;image-rendering:-webkit-optimize-contrast;image-rendering:-o-crisp-edges;image-rendering:pixelated;-ms-interpolation-mode:nearest-neighbor;cursor:none;margin:auto}
</style></head><body><canvas id="canvas"></canvas><script>
var GAME=function(){function e(e){return Math.sin(6.283184*e)}function t(t){return 0>e(t)?-1:1}function r(e){return e%1-.5}function n(e){var t=e%1*4;return 2>t?t-1:3-t}function a(e){return.00390625*Math.pow(1.059463094,e-128)}function i(e,t){setTimeout(function(){var r=new Uint8Array(e*c*2),n=r.length-2,a=function(){for(var e=new Date,i=0;n>=0;)if(r[n]=0,r[n+1]=128,n-=2,(i+=1)%1e3==0&&new Date-e>d)return void setTimeout(a,0);setTimeout(function(){t(r)},0)};setTimeout(a,0)},0)}function o(e,t,r,n,a){var i=r.fx_delay_time*n>>1,o=r.fx_delay_amt/255,s=0,l=function(){for(var r=new Date,n=0;t-i>s;){var c=4*s,f=4*(s+i),u=e[f]+(e[f+1]<<8)+(e[c+2]+(e[c+3]<<8)-32768)*o;if(e[f]=255&u,e[f+1]=u>>8&255,u=e[f+2]+(e[f+3]<<8)+(e[c]+(e[c+1]<<8)-32768)*o,e[f+2]=255&u,e[f+3]=u>>8&255,++s,(n+=1)%1e3==0&&new Date-r>d)return void setTimeout(l,0)}setTimeout(a,0)};setTimeout(l,0)}function s(){stats.begin();let e=(new Date).getTime();h.dt=Math.min(1,(e-h.last)/1e3),h.game.step(h.dt),h.last=e,h.game.render(),stats.end(),requestAnimationFrame(s)}ENGINE={E:this,screen:0,page1:65536,page2:131072,page3:196608,page4:262144,page5:327680,page6:393216,page7:458752,TRANSPARENT:0,BLACK:1,MAGENTA:2,CYAN:3,WHITE:4,colors:[4278190080,4278190080,4294923775,4294967125,4294967295],palDefault:[0,1,2,3,4],pal:[0,1,2,3,4],renderTarget:0,renderSource:65536,currentState:0,playSound:function(e,t,r,n){var a=f.createBufferSource(),i=f.createGain(),o=f.createStereoPanner();return a.buffer=e,a.connect(o),o.connect(i),i.connect(f.destination),a.playbackRate.value=t,a.loop=n,i.gain.value=1,o.pan.value=r,a.start(),{volume:i,sound:a}},gfx:{clear:function(e){h.ram.fill(e,h.renderTarget,h.renderTarget+65536)},pset:function(e,t,r){t|=0,(e|=0)>-1&&256>e&&t>-1&&256>t&&(h.ram[h.renderTarget+(256*t+e)]=r)},line:function(e,t,r,n,a){var i,o,s=(n|=0)-(t|=0),l=(r|=0)-(e|=0);if(0>s?(s=-s,o=-1):o=1,0>l?(l=-l,i=-1):i=1,s<<=1,l<<=1,this.pset(e,t,a),l>s)for(var c=s-(l>>1);e!=r;)0>c||(t+=o,c-=l),e+=i,c+=s,this.pset(e,t,a);else for(c=l-(s>>1);t!=n;)0>c||(e+=i,c-=s),t+=o,c+=l,this.pset(e,t,a)},circle:function(e,t,r,n){var a=-r,i=0,o=2-2*r;do{this.pset(e-a,t+i,n),this.pset(e-i,t-a,n),this.pset(e+a,t-i,n),this.pset(e+i,t+a,n),(r=o)>i||(o+=2*++i+1),(r>a||o>i)&&(o+=2*++a+1)}while(0>a)},fillCircle:function(e,t,r,n){e|=0,t|=0,n|=0;var a=-(r|=0),i=0,o=2-2*r;do{this.line(e-a,t-i,e+a,t-i,n),this.line(e-a,t+i,e+a,t+i,n),(r=o)>i||(o+=2*++i+1),(r>a||o>i)&&(o+=2*++a+1)}while(0>a)},rect:function(e,t,r,n,a){e|=0,r|=0,t|=0,n|=0,this.line(e,t,r,t,a),this.line(r,t,r,n,a),this.line(e,n,r,n,a),this.line(e,t,e,n,a)},fillRect:function(e,t,r,n,a){e|=0,r|=0,t|=0,n|=0;var i=Math.abs(n-t);if(h.gfx.line(e,t,r,t,a),i>0)for(;--i;)h.gfx.line(e,t+i,r,t+i,a);h.gfx.line(e,n,r,n,a)},triangle:function(e,t,r,n,a,i,o){h.gfx.line(e,t,r,n,o),h.gfx.line(r,n,a,i,o),h.gfx.line(a,i,e,t,o)},fillTriangle:function(e,t,r,n,a,i,o){var e=Math.round(16*e),r=Math.round(16*r),a=Math.round(16*a),t=Math.round(16*t),s=e-r,l=(n=Math.round(16*n))-t,c=r-a,d=(i=Math.round(16*i))-n,f=a-e,u=t-i,p=Math.max(Math.min(e,r,a)+15>>4,0),g=Math.min(Math.max(e,r,a)+15>>4,256),y=Math.max(Math.min(t,n,i)+15>>4,0),v=Math.min(Math.max(t,n,i)+15>>4,256);p&=-8,y&=-8;var m=-l*e-s*t,x=-d*r-c*n,w=-u*a-f*i;(l>0||0==l&&s>0)&&m++,(d>0||0==d&&c>0)&&x++,(u>0||0==u&&f>0)&&w++,m=m-1>>4,x=x-1>>4,w=w-1>>4;var _=0,S=0,T=0,M=0,A=0,D=0;0>s?_-=7*s:S-=7*s,0>l?_-=7*l:S-=7*l,0>c?T-=7*c:M-=7*c,0>d?T-=7*d:M-=7*d,0>f?A-=7*f:D-=7*f,0>u?A-=7*u:D-=7*u;for(var b=y;v>b;b+=8)for(var G=p;g>G;G+=8){var E=m+s*b+l*G,C=x+c*b+d*G,k=w+f*b+u*G;if(!(S>E||M>C||D>k)){var z=G+256*b;if(E<_||C<T||k<A)for(B=0;8>B;B++){for(var L=E,R=C,K=k,I=0;8>I;I++)0>(L|R|K)||(h.ram[h.renderTarget+z]=o),L+=l,R+=d,K+=u,z++;E+=s,C+=c,k+=f,z+=248}else for(var B=0;8>B;B++){for(I=0;8>I;I++,z++)h.ram[h.renderTarget+z]=o;z+=248}}}},spr:function(e=0,t=0,r=16,n=16,a=0,i=0,o=!1,s=!1){for(var l=0;n>l;l++)for(var c=0;r>c;c++)255>i+l&&255>a+c&&i+l>-1&&a+c>-1&&(o&s?h.ram[h.renderSource+(256*(t+(n-l))+e+(r-c))]>0&&(h.ram[h.renderTarget+(256*(i+l)+a+c)]=h.pal[h.ram[h.renderSource+(256*(t+(n-l))+e+(r-c))]]):s&&!o?h.ram[h.renderSource+(256*(t+(n-l))+e+c)]>0&&(h.ram[h.renderTarget+(256*(i+l)+a+c)]=h.ram[h.renderSource+(256*(t+(n-l))+e+c)]):o&&!s?h.ram[h.renderSource+(256*(t+l)+e+(r-c))]>0&&(h.ram[h.renderTarget+(256*(i+l)+a+c)]=h.ram[h.renderSource+(256*(t+l)+e+(r-c))]):o||s||h.ram[h.renderSource+(256*(t+l)+e+c)]>0&&(h.ram[h.renderTarget+(256*(i+l)+a+c)]=h.pal[h.ram[h.renderSource+(256*(t+l)+e+c)]]))},sspr:function(e=0,t=0,r=16,n=16,a=0,i=0,o=16,s=16,l=!1,c=!1){for(var d=r/o,f=n/s,u=0;s>u;u++)for(var p=0;o>p;p++)px=p*d|0,py=u*f|0,255>i+u&&255>a+p&&i+u>-1&&a+p>-1&&h.ram[h.renderSource+(256*(t+py)+e+px)]>0&&(h.ram[h.renderTarget+(256*(i+u)+a+p)]=h.ram[h.renderSource+(256*(t+py)+e+px)])},checker:function(e,t,r){var n=256,a=256,i=0,o=0;e=e||8,n/=t=t||8,a/=e;for(var s=0;e>s;++s)for(var l=0,c=t/2;c>l;++l)i=2*l*n+(s%2?0:n),o=s*a,h.gfx.fillRect(i,o,i+n,o+a,r)}},canvasInit:function(){h.canvas=document.getElementById("canvas"),h.ctx=canvas.getContext("2d"),h.canvas.width=window.innerWidth,h.canvas.height=window.innerHeight,h.ctx.imageSmoothingEnabled=!1,h.ctx.mozImageSmoothingEnabled=!1,h.smallcanvas=document.createElement("canvas"),h.smallctx=h.smallcanvas.getContext("2d"),h.smallcanvas.width=256,h.smallcanvas.height=256,h.canvasHeight=h.smallcanvas.height,h.canvasWidth=h.smallcanvas.width,h.imageData=h.smallctx.getImageData(0,0,h.canvasWidth,h.canvasHeight),h.buf=new ArrayBuffer(h.imageData.data.length),h.buf8=new Uint8ClampedArray(h.buf),h.data=new Uint32Array(h.buf),h.ram=new Uint8ClampedArray(524288),h.renderTarget=h.screen},render:function(){for(var e=65536;e--;)h.data[e]=h.colors[h.pal[h.ram[e]]];h.imageData.data.set(h.buf8),h.smallctx.putImageData(h.imageData,0,0),h.compositeSize=window.innerWidth<window.innerHeight?window.innerWidth:window.innerHeight,h.compositeOrigin=(window.innerWidth-h.compositeSize)/2|0,h.ctx.imageSmoothingEnabled=!1,h.ctx.mozImageSmoothingEnabled=!1,h.ctx.drawImage(h.smallcanvas,0,0,255,255,h.compositeOrigin,0,h.compositeSize,h.compositeSize)}};h=ENGINE;Number.prototype.map=function(e,t,r,n){return(this-e)*(n-r)/(t-e)+r},h.assets={song:{rowLen:5513,endPattern:2,songData:[{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:192,osc1_waveform:1,osc2_oct:6,osc2_det:0,osc2_detune:9,osc2_xenv:0,osc2_vol:192,osc2_waveform:1,noise_fader:0,env_attack:137,env_sustain:2e3,env_release:4611,env_master:192,fx_filter:1,fx_freq:982,fx_resonance:89,fx_delay_time:6,fx_delay_amt:25,fx_pan_freq:6,fx_pan_amt:77,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:3,lfo_amt:69,lfo_waveform:0,p:[1],c:[{n:[135,0,0,0,147,0,0,145,0,0,147,0,0,142,0,0,135,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]}],songLen:9},letters:{"-":[[,,,,0],[,,,,0],[1,1,1,1,1],[,,,,0],[,,,,0]],".":[[,,,,0],[,,,,0],[,,,,0],[,,,,0],[,,1,,0]],1:[[,1,1,,0],[,,1,,0],[,,1,,0],[,,1,,0],[1,1,1,1,1]],2:[[1,1,1,1,0],[,,,,1],[,1,1,1,0],[1,,,,0],[1,1,1,1,1]],3:[[1,1,1,1,0],[,,,,1],[,1,1,1,1],[,,,,1],[1,1,1,1,0]],4:[[1,,,1,0],[1,,,1,0],[1,1,1,1,1],[,,,1,0],[,,,1,0]],5:[[1,1,1,1,1],[1,,,,0],[1,1,1,1,0],[,,,,1],[1,1,1,1,0]],6:[[,1,1,1,0],[1,,,,0],[1,1,1,1,0],[1,,,,1],[,1,1,1,0]],7:[[1,1,1,1,1],[,,,,1],[,,,1,0],[,,1,,0],[,,1,,0]],8:[[,1,1,1,0],[1,,,,1],[,1,1,1,0],[1,,,,1],[,1,1,1,0]],9:[[,1,1,1,0],[1,,,,1],[,1,1,1,1],[,,,,1],[,1,1,1,0]],0:[[,1,1,1,0],[1,,,,1],[1,,,,1],[1,,,,1],[,1,1,1,0]],A:[[1,1,1,1,1],[1,,,,1],[1,1,1,1,1],[1,,,,1],[1,,,,1]],B:[[1,1,1,1,0],[1,,,1,0],[1,1,1,1,1],[1,,,,1],[1,1,1,1,1]],C:[[1,1,1,1,1],[1,,,,0],[1,,,,0],[1,,,,0],[1,1,1,1,1]],D:[[1,1,1,,0],[1,,,1,0],[1,,,,1],[1,,,,1],[1,1,1,1,1]],E:[[1,1,1,1,1],[1,,,,0],[1,1,1,,0],[1,,,,0],[1,1,1,1,1]],F:[[1,1,1,1,1],[1,,,,0],[1,1,1,,0],[1,,,,0],[1,,,,0]],G:[[1,1,1,1,1],[1,,,,0],[1,,1,1,1],[1,,,,1],[1,1,1,1,1]],H:[[1,,,,1],[1,,,,1],[1,1,1,1,1],[1,,,,1],[1,,,,1]],I:[[1,1,1,1,1],[,,1,,0],[,,1,,0],[,,1,,0],[1,1,1,1,1]],J:[[,,,,1],[,,,,1],[,,,,1],[1,,,,1],[1,1,1,1,1]],K:[[1,,,1,0],[1,,1,,0],[1,1,1,,0],[1,,,1,0],[1,,,,1]],L:[[1,,,,0],[1,,,,0],[1,,,,0],[1,,,,0],[1,1,1,1,1]],M:[[1,,,,1],[1,1,,1,1],[1,,1,,1],[1,,,,1],[1,,,,1]],N:[[1,,,,1],[1,1,,,1],[1,,1,,1],[1,,,1,1],[1,,,,1]],O:[[1,1,1,1,1],[1,,,,1],[1,,,,1],[1,,,,1],[1,1,1,1,1]],P:[[1,1,1,1,1],[1,,,,1],[1,1,1,1,1],[1,,,,0],[1,,,,0]],Q:[[1,1,1,1,0],[1,,,1,0],[1,,,1,0],[1,,,1,0],[1,1,1,1,1]],R:[[1,1,1,1,1],[1,,,,1],[1,1,1,1,1],[1,,,1,0],[1,,,,1]],S:[[1,1,1,1,1],[1,,,,0],[1,1,1,1,1],[,,,,1],[1,1,1,1,1]],T:[[1,1,1,1,1],[,,1,,0],[,,1,,0],[,,1,,0],[,,1,,0]],U:[[1,,,,1],[1,,,,1],[1,,,,1],[1,,,,1],[1,1,1,1,1]],V:[[1,,,,1],[1,,,,1],[1,,,,1],[,1,,1,0],[,,1,,0]],W:[[1,,,,1],[1,,,,1],[1,,1,,1],[1,1,,1,1],[1,,,,1]],X:[[1,,,,1],[,1,,1,0],[,,1,,0],[,1,,1,0],[1,,,,1]],Y:[[1,,,,1],[1,,,,1],[1,1,1,1,1],[,,1,,0],[,,1,,0]],Z:[[1,1,1,1,1],[,,,1,0],[,,1,,0],[,1,,,0],[1,1,1,1,1]]," ":[[,,,,0],[,,,,0],[,,,,0],[,,,,0],[,,,,0]],",":[[,,,,0],[,,,,0],[,,,,0],[,,1,,0],[,,1,,0]],"+":[[,,,,0],[,,1,,0],[,1,1,1,0],[,,1,,0],[,,,,0]],"/":[[,,,,1],[,,,1,0],[,,1,,0],[,1,,,0],[1,,,,0]],":":[[,,,,0],[,,1,,0],[,,,,0],[,,1,,0],[,,,,0]],"@":[[1,1,1,1,1],[,,,,1],[1,1,1,,1],[1,,1,,1],[1,1,1,1,1]],x:[[1,,1,,1],[,1,,1,0],[1,,1,,1],[,1,,1,0],[1,,1,,1]],z:[[,1,,1,0],[1,,1,,1],[,1,,1,0],[1,,1,,1],[,1,,1,0]],o:[[1,1,1,1,1],[1,,,,1],[1,,1,,1],[1,,,,1],[1,1,1,1,1]],e:[[1,,,,0],[1,1,,,0],[1,1,1,,0],[1,1,1,1,0],[1,1,1,1,1]],w:[[,,,,1],[,,,1,1],[,,1,1,1],[,1,1,1,1],[1,1,1,1,1]],s:[[1,1,1,1,1],[,1,1,1,1],[,,1,1,1],[,,,1,1],[,,,,1]],d:[[1,1,1,1,1],[1,1,1,1,0],[1,1,1,,0],[1,1,,,0],[1,,,,0]],t:[[0,0,0,1,1],[0,0,1,1,1],[0,0,1,1,1],[0,0,1,1,1],[0,0,1,1,1]],y:[[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1]],u:[[1,1,0,0,0],[1,1,1,0,0],[0,0,1,0,0],[0,1,1,0,0],[1,1,1,0,0]],g:[[0,0,1,1,1],[0,0,0,1,1],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,1]],h:[[1,1,1,1,1],[1,1,1,1,1],[0,1,1,1,0],[1,1,1,1,1],[1,1,1,1,1]],j:[[1,1,1,0,0],[1,1,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[1,1,1,1,1]],b:[[0,0,0,1,1],[0,0,0,1,1],[0,0,0,0,1],[0,0,0,0,1],[0,0,0,0,1]],n:[[1,1,1,1,1],[1,1,1,1,1],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],m:[[1,1,1,1,1],[1,0,0,1,1],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0]]}};var l={},c=2,d=33,f=null,u=[e,t,r,n];l.AudioGenerator=function(e){this.mixBuf=e,this.waveSize=e.length/c/2},l.AudioGenerator.prototype.getWave=function(){var e,t,r,n,a,i,o,s=this.mixBuf,l=this.waveSize*c*2;for(i=(a=l-8)-36,n=String.fromCharCode(82,73,70,70,255&a,a>>8&255,a>>16&255,a>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&i,i>>8&255,i>>16&255,i>>24&255),e=0;l>e;){for(r="",t=0;256>t&&l>e;++t,e+=2)o=-32768>(o=4*(s[e]+(s[e+1]<<8)-32768))?-32768:o>32767?32767:o,r+=String.fromCharCode(255&o,o>>8&255);n+=r}return n},l.AudioGenerator.prototype.getAudio=function(){var e=this.getWave(),t=new Audio("data:audio/wav;base64,"+btoa(e));return t.preload="none",t.load(),t},l.AudioGenerator.prototype.getAudioBuffer=function(e){null===f&&(f=new AudioContext);var t=this.mixBuf,r=this.waveSize*c*2,n=f.createBuffer(c,this.waveSize,44100),a=n.getChannelData(0),i=n.getChannelData(1),o=0,s=function(){for(var l=new Date,c=0;r/2>o;){var f=4*(t[4*o]+(t[4*o+1]<<8)-32768);if(f=-32768>f?-32768:f>32767?32767:f,a[o]=f/32768,f=4*(t[4*o+2]+(t[4*o+3]<<8)-32768),f=-32768>f?-32768:f>32767?32767:f,i[o]=f/32768,o+=1,(c+=1)%1e3==0&&new Date-l>d)return void setTimeout(s,0)}setTimeout(function(){e(n)},0)};setTimeout(s,0)},l.SoundGenerator=function(e,t){this.instr=e,this.rowLen=t||5605,this.osc_lfo=u[e.lfo_waveform],this.osc1=u[e.osc1_waveform],this.osc2=u[e.osc2_waveform],this.attack=e.env_attack,this.sustain=e.env_sustain,this.release=e.env_release,this.panFreq=Math.pow(2,e.fx_pan_freq-8)/this.rowLen,this.lfoFreq=Math.pow(2,e.lfo_freq-8)/this.rowLen},l.SoundGenerator.prototype.genSound=function(t,r,n){new Date;for(var i=0,o=0,s=a(t+12*(this.instr.osc1_oct-8)+this.instr.osc1_det)*(1+8e-4*this.instr.osc1_detune),l=a(t+12*(this.instr.osc2_oct-8)+this.instr.osc2_det)*(1+8e-4*this.instr.osc2_detune),c=this.instr.fx_resonance/255,d=0,f=0,u=this.attack+this.sustain+this.release-1;u>=0;--u){var p=u+n,h=this.osc_lfo(p*this.lfoFreq)*this.instr.lfo_amt/512+.5,g=1;u<this.attack?g=u/this.attack:u<this.attack+this.sustain||(g-=(u-this.attack-this.sustain)/this.release);var y=s;this.instr.lfo_osc1_freq&&(y+=h),this.instr.osc1_xenv&&(y*=g*g),i+=y;var v=this.osc1(i)*this.instr.osc1_vol;y=l,this.instr.osc2_xenv&&(y*=g*g),o+=y,v+=this.osc2(o)*this.instr.osc2_vol,this.instr.noise_fader&&(v+=(2*Math.random()-1)*this.instr.noise_fader*g),v*=g/255;var m=this.instr.fx_freq;this.instr.lfo_fx_freq&&(m*=h);var x=c*(v-f)-(d+=(m=1.5*Math.sin(3.141592*m/44100))*f);switch(f+=m*x,this.instr.fx_filter){case 1:v=x;break;case 2:v=d;break;case 3:v=f;break;case 4:v=d+x}if(y=e(p*this.panFreq)*this.instr.fx_pan_amt/512+.5,v*=39*this.instr.env_master,(p*=4)+3<r.length){var w=r[p]+(r[p+1]<<8)+v*(1-y);r[p]=255&w,r[p+1]=w>>8&255,w=r[p+2]+(r[p+3]<<8)+v*y,r[p+2]=255&w,r[p+3]=w>>8&255}}},l.SoundGenerator.prototype.getAudioGenerator=function(e,t){var r=this.attack+this.sustain+this.release-1+32*this.rowLen,n=this;i(r,function(a){n.genSound(e,a,0),o(a,r,n.instr,n.rowLen,function(){t(new l.AudioGenerator(a))})})},l.SoundGenerator.prototype.createAudio=function(e,t){this.getAudioGenerator(e,function(e){t(e.getAudio())})},l.SoundGenerator.prototype.createAudioBuffer=function(e,t){this.getAudioGenerator(e,function(e){e.getAudioBuffer(t)})},l.MusicGenerator=function(e){this.song=e,this.waveSize=44100*e.songLen},l.MusicGenerator.prototype.generateTrack=function(e,t,r){var n=this;i(this.waveSize,function(a){var i=n.waveSize,s=n.waveSize*c*2,f=n.song.rowLen,u=n.song.endPattern,p=new l.SoundGenerator(e,f),h=0,g=0,y=0,v=function(){for(var t=new Date;;)if(32!==y){if(g===u-1)return void setTimeout(m,0);var r=e.p[g];if(r){var n=e.c[r-1].n[y];n&&p.genSound(n,a,h)}if(h+=f,y+=1,new Date-t>d)return void setTimeout(v,0)}else y=0,g+=1},m=function(){o(a,i,e,f,w)},x=0,w=function(){for(var e=new Date,n=0;s>x;){var i=t[x]+(t[x+1]<<8)+a[x]+(a[x+1]<<8)-32768;if(t[x]=255&i,t[x+1]=i>>8&255,x+=2,(n+=1)%1e3==0&&new Date-e>d)return void setTimeout(w,0)}setTimeout(r,0)};setTimeout(v,0)})},l.MusicGenerator.prototype.getAudioGenerator=function(e){var t=this;i(this.waveSize,function(r){var n=0,a=function(){n<t.song.songData.length?(n+=1,t.generateTrack(t.song.songData[n-1],r,a)):e(new l.AudioGenerator(r))};a()})},l.MusicGenerator.prototype.createAudio=function(e){this.getAudioGenerator(function(t){e(t.getAudio())})},l.MusicGenerator.prototype.createAudioBuffer=function(e){this.getAudioGenerator(function(t){t.getAudioBuffer(e)})};var p=function(){function e(e){return n.appendChild(e.dom),e}function t(e){for(var t=0;t<n.children.length;t++)n.children[t].style.display=t===e?"block":"none";r=e}var r=0,n=document.createElement("div");n.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",n.addEventListener("click",function(e){e.preventDefault(),t(++r%n.children.length)},!1);var a=(performance||Date).now(),i=a,o=0,s=e(new p.Panel("FPS","#0ff","#002")),l=e(new p.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=e(new p.Panel("MB","#f08","#201"));return t(0),{REVISION:16,dom:n,addPanel:e,showPanel:t,begin:function(){a=(performance||Date).now()},end:function(){o++;var e=(performance||Date).now();if(l.update(e-a,200),e>i+1e3&&(s.update(1e3*o/(e-i),100),i=e,o=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){a=this.end()},domElement:n,setMode:t}};p.Panel=function(e,t,r){var n=1/0,a=0,i=Math.round,o=i(window.devicePixelRatio||1),s=80*o,l=48*o,c=3*o,d=2*o,f=3*o,u=15*o,p=74*o,h=30*o,g=document.createElement("canvas");g.width=s,g.height=l,g.style.cssText="width:80px;height:48px";var y=g.getContext("2d");return y.font="bold "+9*o+"px Helvetica,Arial,sans-serif",y.textBaseline="top",y.fillStyle=r,y.fillRect(0,0,s,l),y.fillStyle=t,y.fillText(e,c,d),y.fillRect(f,u,p,h),y.fillStyle=r,y.globalAlpha=.9,y.fillRect(f,u,p,h),{dom:g,update:function(l,v){n=Math.min(n,l),a=Math.max(a,l),y.fillStyle=r,y.globalAlpha=1,y.fillRect(0,0,s,u),y.fillStyle=t,y.fillText(i(l)+" "+e+" ("+i(n)+"-"+i(a)+")",c,d),y.drawImage(g,f+o,u,p-o,h,f,u,p-o,h),y.fillRect(f+p-o,u,o,h),y.fillStyle=r,y.globalAlpha=.9,y.fillRect(f+p-o,u,o,i((1-l/v)*h))}}},"object"==typeof module&&(module.exports=p),Key={_pressed:{},_released:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,a:65,w:87,s:83,d:68,z:90,x:88,f:70,p:80,r:82,isDown:function(e){return this._pressed[e]},justReleased:function(e){return this._released[e]},onKeydown:function(e){this._pressed[e.keyCode]=!0},onKeyup:function(e){this._released[e.keyCode]=!0,delete this._pressed[e.keyCode]},update:function(){this._released={}}},Txt={textLine:function(e){for(var t=e.text.length,r=0;t>r;r++)for(var n=h.assets.letters[e.text.charAt(r)]||h.assets.letters.unknown,a=0;5>a;a++)for(var i=0;5>i;i++)1===n[a][i]&&(1===e.scale?h.gfx.pset(e.x+i*e.scale+(5*e.scale+e.hspacing)*r,e.y+a*e.scale,e.color):h.gfx.fillRect(e.x+i*e.scale+(5*e.scale+e.hspacing)*r,e.y+a*e.scale,e.x+i*e.scale+(5*e.scale+e.hspacing)*r+e.scale,e.y+a*e.scale+e.scale,e.color))},text:function(e){var t=5*e.scale,r=e.text.split("\n"),n=r.slice(0),a=r.length,i=n.sort(function(e,t){return t.length-e.length})[0],o=i.length*t+(i.length-1)*e.hspacing,s=a*t+(a-1)*e.vspacing,l=e.x,c=e.y,d=e.x+o,f=e.y+s;"center"==e.halign?(l=e.x-o/2,d=e.x+o/2):"right"==e.halign&&(l=e.x-o,d=e.x),"center"==e.valign?(c=e.y-s/2,f=e.y+s/2):"bottom"==e.valign&&(c=e.y-s,f=e.y);var u=l+o/2,p=c+s/2;if(e.render)for(var h=0;a>h;h++){var g=r[h],y=g.length*t+(g.length-1)*e.hspacing,v=e.x,m=e.y+(t+e.vspacing)*h;"center"==e.halign?v=e.x-y/2:"right"==e.halign&&(v=e.x-y),"center"==e.valign?m-=s/2:"bottom"==e.valign&&(m-=s),e.snap&&(v=Math.floor(v),m=Math.floor(m)),this.textLine({ctx:e.ctx,x:v,y:m,text:g,hspacing:e.hspacing||0,scale:e.scale||1,color:e.color})}return{sx:l,sy:c,cx:u,cy:p,ex:d,ey:f,width:o,height:s}}},h.game={create:function(){h.sounds={},window.AudioContext=window.AudioContext||window.webkitAudioContext,f=new AudioContext,new l.MusicGenerator(h.assets.song).createAudioBuffer(function(e){h.sounds.song=e}),h.triangles=[];for(var e=0;200>e;e++){let e=255*Math.random()|0,t=255*Math.random()|0,r=10*Math.random();h.triangles.push({x1:e+Math.random()*r*4-r,y1:t+Math.random()*r*4-r,x2:e+Math.random()*r*4-r,y2:t+Math.random()*r*4-r,x3:e+Math.random()*r*4-r,y3:t+Math.random()*r*4-r,color:1+(2*Math.random()|0),speed:r})}h.t=0,h.moveX=0,h.speedFactor=.2,h.songTrigger=!1,h.cursor={x:0,y:0}},resize:function(){h.canvas.width=window.innerWidth,h.canvas.height=window.innerHeight},step:function(e){h.t+=e,h.cos=Math.cos(e),h.sin=Math.sin(e);for(var t=0;t<h.triangles.length;t++){var r=h.triangles[t];r.y1+=r.speed*h.speedFactor,r.y2+=r.speed*h.speedFactor,r.y3+=r.speed*h.speedFactor,280>r.y1||(r.y1-=280,r.y2-=280,r.y3-=280)}h.player.update(e),Key.isDown(Key.z)&&(h.songTrigger=!0),h.songTrigger&&(h.songTrigger=!1,h.playSound(h.sounds.song,1,1,0))},render:function(e){h.renderTarget=h.page1,h.gfx.fillRect(0,0,256,256,0);for(t=0;t<h.triangles.length;t++)h.gfx.triangle(h.triangles[t].x1,h.triangles[t].y1,h.triangles[t].x2,h.triangles[t].y2,h.triangles[t].x3,h.triangles[t].y3,h.triangles[t].color);h.player.draw(),h.renderTarget=h.page3;for(var t=2e3;t--;){var r=256*Math.random()|0,n=256*Math.random()|0,a=h.ram[h.page1+(256*n+r)];h.gfx.circle(r,n+1,1,a-1)}h.renderTarget=h.page2,h.gfx.fillRect(0,0,256,256,0),Txt.text({x:8,y:240,text:"X: "+(""+h.player.x).substring(0,7)+"\nY: "+(""+h.player.y).substring(0,7),hspacing:2,vspacing:2,halign:"left",valign:"top",scale:1,snap:1,render:1,color:h.CYAN}),h.renderSource=h.page3,h.renderTarget=h.screen,h.gfx.fillRect(0,0,256,256,1),h.gfx.spr(0,0,256,256),h.renderSource=h.page1,h.renderTarget=h.screen,h.gfx.spr(0,0,256,256),h.renderSource=h.page2,h.renderTarget=h.screen,h.gfx.spr(0,0,256,256),h.render()}},h.player={x:128,y:230,radius:3,xvel:0,yvel:0,speed:6,drag:.97,x1:119,x2:137,x3:128,y1:137,y2:137,y3:119,update:function(e){let t=e*h.player.xvel*h.player.drag,r=e*h.player.yvel*h.player.drag;h.player.x+=t,h.player.y+=r,h.player.x1+=t,h.player.x2+=t,h.player.x3+=t,h.player.y1+=r,h.player.y2+=r,h.player.y3+=r;let n=h.player.x1-h.player.x,a=h.player.x2-h.player.x,i=h.player.x3-h.player.x,o=h.player.y1-h.player.y,s=h.player.y2-h.player.y,l=h.player.y3-h.player.y;h.player.x1=h.cos*n-h.sin*o+h.player.x,h.player.y1=h.sin*n+h.cos*o+h.player.y,h.player.x2=h.cos*a-h.sin*s+h.player.x,h.player.y2=h.sin*a+h.cos*s+h.player.y,h.player.x3=h.cos*i-h.sin*l+h.player.x,h.player.y3=h.sin*i+h.cos*l+h.player.y,Key.isDown(Key.a)&&(h.player.xvel-=h.player.speed),Key.isDown(Key.d)&&(h.player.xvel+=h.player.speed),Key.isDown(Key.w)&&(h.player.yvel-=h.player.speed),Key.isDown(Key.s)&&(h.player.yvel+=h.player.speed),h.player.x>256+2*h.player.radius&&(h.player.x=-h.player.radius),h.player.x<0-2*h.player.radius&&(h.player.x=256+h.player.radius),h.player.y>256+2*h.player.radius&&(h.player.y=-h.player.radius),h.player.y<0-2*h.player.radius&&(h.player.y=256+h.player.radius)},draw:function(e){h.gfx.fillCircle(h.player.x,h.player.y,h.player.radius,4),h.gfx.triangle(h.player.x1,h.player.y1,h.player.x2,h.player.y2,h.player.x3,h.player.y3,h.WHITE)}};var h=ENGINE;init=function(){h.last=0,h.dt=0,h.now=0,stats=new p,document.body.appendChild(stats.dom),h.canvasInit(),h.game.create(),window.addEventListener("keyup",function(e){Key.onKeyup(e)},!1),window.addEventListener("keydown",function(e){Key.onKeydown(e)},!1),window.addEventListener("blur",function(e){paused=!0},!1),window.addEventListener("focus",function(e){paused=!1},!1),window.addEventListener("resize",h.game.resize),s()},window.onload=init()}();
</script></body></html>