<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Game Zero ES6</title><style>
body{margin:0;overflow:hidden;background:#111;color:#ccc}#canvas{position:absolute;top:0;bottom:0;left:0;right:0;width:100%;height:100%;image-rendering:optimizeSpeed;image-rendering:-moz-crisp-edges;image-rendering:-webkit-optimize-contrast;image-rendering:-o-crisp-edges;image-rendering:pixelated;-ms-interpolation-mode:nearest-neighbor;cursor:none;margin:auto}
</style></head><body><canvas id="canvas"></canvas><script>
var GAME=function(){function e(e,t,n){function r(e,t){if("download"in d)return d.href=e,d.setAttribute("download",g),d.innerHTML="downloading...",d.style.display="none",u.body.appendChild(d),setTimeout(function(){d.click(),u.body.removeChild(d),!0===t&&setTimeout(function(){s.URL.revokeObjectURL(d.href)},250)},66),!0;var n=u.createElement("iframe");u.body.appendChild(n),t||(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,h)),n.src=e,setTimeout(function(){u.body.removeChild(n)},333)}var i,a,o,s=window,h="application/octet-stream",l=n||h,c=e,u=document,d=u.createElement("a"),f=function(e){return e+""},p=s.Blob||s.MozBlob||s.WebKitBlob||f,m=s.MSBlobBuilder||s.WebKitBlobBuilder||s.BlobBuilder,g=t||"download";if("true"==this+""&&(c=[c,l],l=c[0],c=c[1]),(c+"").match(/^data\:[\w+\-]+\/[\w+\-]+[,;]/))return navigator.msSaveBlob?navigator.msSaveBlob(function(e){var t=e.split(/[:;,]/),n=t[1],r=("base64"==t[2]?atob:decodeURIComponent)(t.pop()),i=r.length,a=0,o=new Uint8Array(i);for(a;i>a;++a)o[a]=r.charCodeAt(a);return new p([o],{type:n})}(c),g):r(c);try{i=c instanceof p?c:new p([c],{type:l})}catch(e){m&&((a=new m).append([c]),i=a.getBlob(l))}if(navigator.msSaveBlob)return navigator.msSaveBlob(i,g);if(s.URL)r(s.URL.createObjectURL(i),!0);else{if("string"==typeof i||i.constructor===f)try{return r("data:"+l+";base64,"+s.btoa(i))}catch(e){return r("data:"+l+","+encodeURIComponent(i))}(o=new FileReader).onload=function(e){r(this.result)},o.readAsDataURL(i)}return!0}function t(e){return Math.sin(6.283184*e)}function n(e){return 0>t(e)?-1:1}function r(e){return e%1-.5}function i(e){var t=e%1*4;return 2>t?t-1:3-t}function a(e){return.00390625*Math.pow(1.059463094,e-128)}function o(e,t){setTimeout(function(){var n=new Uint8Array(e*c*2),r=n.length-2,i=function(){for(var e=new Date,a=0;r>=0;)if(n[r]=0,n[r+1]=128,r-=2,(a+=1)%1e3==0&&new Date-e>u)return void setTimeout(i,0);setTimeout(function(){t(n)},0)};setTimeout(i,0)},0)}function s(e,t,n,r,i){var a=n.fx_delay_time*r>>1,o=n.fx_delay_amt/255,s=0,h=function(){for(var n=new Date,r=0;t-a>s;){var l=4*s,c=4*(s+a),d=e[c]+(e[c+1]<<8)+(e[l+2]+(e[l+3]<<8)-32768)*o;if(e[c]=255&d,e[c+1]=d>>8&255,d=e[c+2]+(e[c+3]<<8)+(e[l]+(e[l+1]<<8)-32768)*o,e[c+2]=255&d,e[c+3]=d>>8&255,++s,(r+=1)%1e3==0&&new Date-n>u)return void setTimeout(h,0)}setTimeout(i,0)};setTimeout(h,0)}function h(){stats.begin();let e=(new Date).getTime();m.dt=Math.min(1,(e-m.last)/1e3),m.game.step(m.dt),m.last=e,m.game.render(),stats.end(),requestAnimationFrame(h)}ENGINE={E:this,screen:0,page1:65536,page2:131072,page3:196608,page4:262144,page5:327680,page6:393216,page7:458752,TRANSPARENT:0,BLACK:1,MAGENTA:2,CYAN:3,WHITE:4,colors:[4278190080,4278190080,4294923775,4294967125,4294967295],palDefault:[0,1,2,3,4],pal:[0,1,2,3,4],renderTarget:0,renderSource:65536,currentState:0,playSound:function(e,t,n,r){var i=d.createBufferSource(),a=d.createGain(),o=d.createStereoPanner();return i.buffer=e,i.connect(o),o.connect(a),a.connect(d.destination),i.playbackRate.value=t,i.loop=r,a.gain.value=1,o.pan.value=n,i.start(),{volume:a,sound:i}},gfx:{clear:function(e){m.ram.fill(e,m.renderTarget,m.renderTarget+65536)},pset:function(e,t,n){t|=0,(e|=0)>-1&&256>e&&t>-1&&256>t&&(m.ram[m.renderTarget+(256*t+e)]=n)},line:function(e,t,n,r,i){var a,o,s=(r|=0)-(t|=0),h=(n|=0)-(e|=0);if(0>s?(s=-s,o=-1):o=1,0>h?(h=-h,a=-1):a=1,s<<=1,h<<=1,this.pset(e,t,i),h>s)for(var l=s-(h>>1);e!=n;)0>l||(t+=o,l-=h),e+=a,l+=s,this.pset(e,t,i);else for(l=h-(s>>1);t!=r;)0>l||(e+=a,l-=s),t+=o,l+=h,this.pset(e,t,i)},circle:function(e,t,n,r){var i=-n,a=0,o=2-2*n;do{this.pset(e-i,t+a,r),this.pset(e-a,t-i,r),this.pset(e+i,t-a,r),this.pset(e+a,t+i,r),(n=o)>a||(o+=2*++a+1),(n>i||o>a)&&(o+=2*++i+1)}while(0>i)},fillCircle:function(e,t,n,r){e|=0,t|=0,r|=0;var i=-(n|=0),a=0,o=2-2*n;do{this.line(e-i,t-a,e+i,t-a,r),this.line(e-i,t+a,e+i,t+a,r),(n=o)>a||(o+=2*++a+1),(n>i||o>a)&&(o+=2*++i+1)}while(0>i)},rect:function(e,t,n,r,i){e|=0,n|=0,t|=0,r|=0,this.line(e,t,n,t,i),this.line(n,t,n,r,i),this.line(e,r,n,r,i),this.line(e,t,e,r,i)},fillRect:function(e,t,n,r,i){e|=0,n|=0,t|=0,r|=0;var a=Math.abs(r-t);if(m.gfx.line(e,t,n,t,i),a>0)for(;--a;)m.gfx.line(e,t+a,n,t+a,i);m.gfx.line(e,r,n,r,i)},triangle:function(e,t,n,r,i,a,o){m.gfx.line(e,t,n,r,o),m.gfx.line(n,r,i,a,o),m.gfx.line(i,a,e,t,o)},fillTriangle:function(e,t,n,r,i,a,o){var e=Math.round(16*e),n=Math.round(16*n),i=Math.round(16*i),t=Math.round(16*t),s=e-n,h=(r=Math.round(16*r))-t,l=n-i,c=(a=Math.round(16*a))-r,u=i-e,d=t-a,f=Math.max(Math.min(e,n,i)+15>>4,0),p=Math.min(Math.max(e,n,i)+15>>4,256),g=Math.max(Math.min(t,r,a)+15>>4,0),y=Math.min(Math.max(t,r,a)+15>>4,256);f&=-8,g&=-8;var v=-h*e-s*t,w=-c*n-l*r,x=-d*i-u*a;(h>0||0==h&&s>0)&&v++,(c>0||0==c&&l>0)&&w++,(d>0||0==d&&u>0)&&x++,v=v-1>>4,w=w-1>>4,x=x-1>>4;var b=0,_=0,k=0,T=0,S=0,A=0;0>s?b-=7*s:_-=7*s,0>h?b-=7*h:_-=7*h,0>l?k-=7*l:T-=7*l,0>c?k-=7*c:T-=7*c,0>u?S-=7*u:A-=7*u,0>d?S-=7*d:A-=7*d;for(var C=g;y>C;C+=8)for(var M=f;p>M;M+=8){var D=v+s*C+h*M,E=w+l*C+c*M,L=x+u*C+d*M;if(!(_>D||T>E||A>L)){var I=M+256*C;if(D<b||E<k||L<S)for(P=0;8>P;P++){for(var F=D,B=E,R=L,z=0;8>z;z++)0>(F|B|R)||(m.ram[m.renderTarget+I]=o),F+=h,B+=c,R+=d,I++;D+=s,E+=l,L+=u,I+=248}else for(var P=0;8>P;P++){for(z=0;8>z;z++,I++)m.ram[m.renderTarget+I]=o;I+=248}}}},spr:function(e=0,t=0,n=16,r=16,i=0,a=0,o=!1,s=!1){for(var h=0;r>h;h++)for(var l=0;n>l;l++)255>a+h&&255>i+l&&a+h>-1&&i+l>-1&&(o&s?m.ram[m.renderSource+(256*(t+(r-h))+e+(n-l))]>0&&(m.ram[m.renderTarget+(256*(a+h)+i+l)]=m.pal[m.ram[m.renderSource+(256*(t+(r-h))+e+(n-l))]]):s&&!o?m.ram[m.renderSource+(256*(t+(r-h))+e+l)]>0&&(m.ram[m.renderTarget+(256*(a+h)+i+l)]=m.ram[m.renderSource+(256*(t+(r-h))+e+l)]):o&&!s?m.ram[m.renderSource+(256*(t+h)+e+(n-l))]>0&&(m.ram[m.renderTarget+(256*(a+h)+i+l)]=m.ram[m.renderSource+(256*(t+h)+e+(n-l))]):o||s||m.ram[m.renderSource+(256*(t+h)+e+l)]>0&&(m.ram[m.renderTarget+(256*(a+h)+i+l)]=m.pal[m.ram[m.renderSource+(256*(t+h)+e+l)]]))},sspr:function(e=0,t=0,n=16,r=16,i=0,a=0,o=16,s=16,h=!1,l=!1){for(var c=n/o,u=r/s,d=0;s>d;d++)for(var f=0;o>f;f++)px=f*c|0,py=d*u|0,255>a+d&&255>i+f&&a+d>-1&&i+f>-1&&m.ram[m.renderSource+(256*(t+py)+e+px)]>0&&(m.ram[m.renderTarget+(256*(a+d)+i+f)]=m.ram[m.renderSource+(256*(t+py)+e+px)])},checker:function(e,t,n){var r=256,i=256,a=0,o=0;e=e||8,r/=t=t||8,i/=e;for(var s=0;e>s;++s)for(var h=0,l=t/2;l>h;++h)a=2*h*r+(s%2?0:r),o=s*i,m.gfx.fillRect(a,o,a+r,o+i,n)}},canvasInit:function(){m.canvas=document.getElementById("canvas"),m.ctx=canvas.getContext("2d"),m.canvas.width=window.innerWidth,m.canvas.height=window.innerHeight,m.ctx.imageSmoothingEnabled=!1,m.ctx.mozImageSmoothingEnabled=!1,m.smallcanvas=document.createElement("canvas"),m.smallctx=m.smallcanvas.getContext("2d"),m.smallcanvas.width=256,m.smallcanvas.height=256,m.canvasHeight=m.smallcanvas.height,m.canvasWidth=m.smallcanvas.width,m.imageData=m.smallctx.getImageData(0,0,m.canvasWidth,m.canvasHeight),m.buf=new ArrayBuffer(m.imageData.data.length),m.buf8=new Uint8ClampedArray(m.buf),m.data=new Uint32Array(m.buf),m.ram=new Uint8ClampedArray(524288),m.renderTarget=m.screen},render:function(){for(var e=65536;e--;)m.data[e]=m.colors[m.pal[m.ram[e]]];m.imageData.data.set(m.buf8),m.smallctx.putImageData(m.imageData,0,0),m.compositeSize=window.innerWidth<window.innerHeight?window.innerWidth:window.innerHeight,m.compositeOrigin=(window.innerWidth-m.compositeSize)/2|0,m.ctx.imageSmoothingEnabled=!1,m.ctx.mozImageSmoothingEnabled=!1,m.ctx.drawImage(m.smallcanvas,0,0,255,255,m.compositeOrigin,0,m.compositeSize,m.compositeSize)},switchState:function(e){arguments.length>0?app.setState(m.states[e]):(m.currentState+=1,m.currentState>m.states.length-1&&(m.currentState=0),app.setState(m.states[m.currentState]))}};m=ENGINE;Number.prototype.map=function(e,t,n,r){return(this-e)*(r-n)/(t-e)+n},window.Whammy=function(){function e(e,n){for(var r=t(e),i=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:u(r.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:r.width,id:176},{data:r.height,id:186}]}]}]},{id:475249515,data:[]}]}],a=i[1],s=a.data[2],l=0,c=0;l<e.length;){var d={id:187,data:[{data:Math.round(c),id:179},{id:183,data:[{data:1,id:247},{data:0,size:8,id:241}]}]};s.data.push(d);var f=[],p=0;do{f.push(e[l]),p+=e[l].duration,l++}while(l<e.length&&3e4>p);var m=0,g={id:524531317,data:[{data:Math.round(c),id:231}].concat(f.map(function(e){var t=h({discardable:0,frame:e.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(m)});return m+=e.duration,{data:t,id:163}}))};a.data.push(g),c+=p}for(var y=0,v=0;v<a.data.length;v++){v>=3&&(s.data[v-3].data[1].data[1].data=y);var w=o([a.data[v]],n);y+=w.size||w.byteLength||w.length,2!=v&&(a.data[v]=w)}return o(i,n)}function t(e){for(var t=e[0].width,n=e[0].height,r=e[0].duration,i=1;i<e.length;i++){if(e[i].width!=t)throw"Frame "+(i+1)+" has a different width";if(e[i].height!=n)throw"Frame "+(i+1)+" has a different height";if(0>e[i].duration||e[i].duration>32767)throw"Frame "+(i+1)+" has a weird duration (must be between 0 and 32767)";r+=e[i].duration}return{duration:r,width:t,height:n}}function n(e){for(var t=[];e>0;)t.push(255&e),e>>=8;return new Uint8Array(t.reverse())}function r(e,t){for(var n=new Uint8Array(t),r=t-1;r>=0;r--)n[r]=255&e,e>>=8;return n}function i(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}function a(e){var t=[];e=(e.length%8?Array(9-e.length%8).join("0"):"")+e;for(var n=0;n<e.length;n+=8)t.push(parseInt(e.substr(n,8),2));return new Uint8Array(t)}function o(e,t){for(var h=[],l=0;l<e.length;l++)if("id"in e[l]){var c=e[l].data;"object"==typeof c&&(c=o(c,t)),"number"==typeof c&&(c="size"in e[l]?r(c,e[l].size):a(c.toString(2))),"string"==typeof c&&(c=i(c)),c.length;for(var u=c.size||c.byteLength||c.length,d=0,f=56;f>0;f-=7)if(u>Math.pow(2,f)-2){d=f/7;break}var p=u.toString(2),m=Array(8*(d+1)+1).join("0"),g=Array(d+1).join("0")+1,y=g+(m.substr(0,m.length-p.length-g.length)+p);h.push(n(e[l].id)),h.push(a(y)),h.push(c)}else h.push(e[l]);if(t){var v=s(h);return new Uint8Array(v)}return new Blob(h,{type:"video/webm"})}function s(e,t){null==t&&(t=[]);for(var n=0;n<e.length;n++)"object"==typeof e[n]?s(e[n],t):t.push(e[n]);return t}function h(e){var t=0;if(e.keyframe&&(t|=128),e.invisible&&(t|=8),e.lacing&&(t|=e.lacing<<1),e.discardable&&(t|=1),e.trackNum>127)throw"TrackNumber > 127 not supported";return[128|e.trackNum,e.timecode>>8,255&e.timecode,t].map(function(e){return String.fromCharCode(e)}).join("")+e.frame}function l(e){for(var t=e.RIFF[0].WEBP[0],n=t.indexOf("*"),r=0,i=[];4>r;r++)i[r]=t.charCodeAt(n+3+r);var a,o,s;return s=i[1]<<8|i[0],a=16383&s,s>>14,s=i[3]<<8|i[2],o=16383&s,s>>14,{width:a,height:o,data:t,riff:e}}function c(e){for(var t=0,n={};t<e.length;){var r=e.substr(t,4);if(n[r]=n[r]||[],"RIFF"==r||"LIST"==r){var i=parseInt(e.substr(t+4,4).split("").map(function(e){var t=e.charCodeAt(0).toString(2);return Array(8-t.length+1).join("0")+t}).join(""),2),a=e.substr(t+4+4,i);t+=8+i,n[r].push(c(a))}else"WEBP"==r?(n[r].push(e.substr(t+8)),t=e.length):(n[r].push(e.substr(t+4)),t=e.length)}return n}function u(e){return[].slice.call(new Uint8Array(new Float64Array([e]).buffer),0).map(function(e){return String.fromCharCode(e)}).reverse().join("")}function d(e,t){this.frames=[],this.duration=1e3/e,this.quality=t||.8}return d.prototype.add=function(e,t){if(void 0!==t&&this.duration)throw"you can't pass a duration if the fps is set";if(void 0===t&&!this.duration)throw"if you don't have the fps set, you need to have durations here.";if(e.canvas&&(e=e.canvas),e.toDataURL)e=e.getContext("2d").getImageData(0,0,e.width,e.height);else if("string"!=typeof e)throw"frame must be a a HTMLCanvasElement, a CanvasRenderingContext2D or a DataURI formatted string";if("string"==typeof e&&!/^data:image\/webp;base64,/gi.test(e))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:e,duration:t||this.duration})},d.prototype.encodeFrames=function(e){if(this.frames[0].image instanceof ImageData){var t=this.frames,n=document.createElement("canvas"),r=n.getContext("2d");n.width=this.frames[0].image.width,n.height=this.frames[0].image.height;var i=function(a){var o=t[a];r.putImageData(o.image,0,0),o.image=n.toDataURL("image/webp",this.quality),a<t.length-1?setTimeout(function(){i(a+1)},1):e()}.bind(this);i(0)}else e()},d.prototype.compile=function(t,n){this.encodeFrames(function(){var r=new e(this.frames.map(function(e){var t=l(c(atob(e.image.slice(23))));return t.duration=e.duration,t}),t);n(r)}.bind(this))},{Video:d,fromImageArray:function(t,n,r){return e(t.map(function(e){var t=l(c(atob(e.slice(23))));return t.duration=1e3/n,t}),r)},toWebM:e}}(),function(){"use strict";function e(e){var t,n=new Uint8Array(e);for(t=0;e>t;t+=1)n[t]=0;return n}function t(t,n,r,i){var a=n+r,o=e((parseInt(a/i)+1)*i);return o.set(t),o}function n(e,t,n){return e=e.toString(n||8),"000000000000".substr(e.length+12-t)+e}function r(t,n,r){var i,a;for(n=n||e(t.length),r=r||0,i=0,a=t.length;a>i;i+=1)n[r]=t.charCodeAt(i),r+=1;return n}function i(e){var t,n,r,i=e.length%3,o="";for(t=0,r=e.length-i;r>t;t+=3)n=(e[t]<<16)+(e[t+1]<<8)+e[t+2],o+=function(e){return a[e>>18&63]+a[e>>12&63]+a[e>>6&63]+a[63&e]}(n);switch(o.length%4){case 1:o+="=";break;case 2:o+="=="}return o}var a=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"];window.utils={},window.utils.clean=e,window.utils.pad=n,window.utils.extend=t,window.utils.stringToUint8=r,window.utils.uint8ToBase64=i}(),function(){"use strict";function e(e,r){var i=n.clean(512),a=0;return t.forEach(function(t){var n,r,o=e[t.field]||"";for(n=0,r=o.length;r>n;n+=1)i[a]=o.charCodeAt(n),a+=1;a+=t.length-n}),"function"==typeof r?r(i,a):i}var t,n=window.utils;t=[{field:"fileName",length:100},{field:"fileMode",length:8},{field:"uid",length:8},{field:"gid",length:8},{field:"fileSize",length:12},{field:"mtime",length:12},{field:"checksum",length:8},{field:"type",length:1},{field:"linkName",length:100},{field:"ustar",length:8},{field:"owner",length:32},{field:"group",length:32},{field:"majorNumber",length:8},{field:"minorNumber",length:8},{field:"filenamePrefix",length:155},{field:"padding",length:12}],window.header={},window.header.structure=t,window.header.format=e}(),function(){"use strict";function e(e){this.written=0,t=(e||20)*i,this.out=r.clean(t),this.blocks=[],this.length=0}var t,n=window.header,r=window.utils,i=512;e.prototype.append=function(e,t,a,o){var s,h,l,c,u,d,f;if("string"==typeof t)t=r.stringToUint8(t);else if(t.constructor!==Uint8Array.prototype.constructor)throw"Invalid input type. You gave me: "+(""+t.constructor).match(/function\s*([$A-Za-z_][0-9A-Za-z_]*)\s*\(/)[1];"function"==typeof a&&(a,a={}),l=(a=a||{}).mode||4095&parseInt("777",8),c=a.mtime||Math.floor(+new Date/1e3),u=a.uid||0,d=a.gid||0,s={fileName:e,fileMode:r.pad(l,7),uid:r.pad(u,7),gid:r.pad(d,7),fileSize:r.pad(t.length,11),mtime:r.pad(c,11),checksum:"        ",type:"0",ustar:"ustar  ",owner:a.owner||"",group:a.group||""},h=0,Object.keys(s).forEach(function(e){var t,n,r=s[e];for(t=0,n=r.length;n>t;t+=1)h+=r.charCodeAt(t)}),s.checksum=r.pad(h,6)+"\0 ",f=n.format(s);var p=Math.ceil(f.length/i)*i,m=Math.ceil(t.length/i)*i;this.blocks.push({header:f,input:t,headerLength:p,inputLength:m})},e.prototype.save=function(){var e=[],t=[],n=0,r=Math.pow(2,20),a=[];return this.blocks.forEach(function(e){n+e.headerLength+e.inputLength>r&&(t.push({blocks:a,length:n}),a=[],n=0),a.push(e),n+=e.headerLength+e.inputLength}),t.push({blocks:a,length:n}),t.forEach(function(t){var n=new Uint8Array(t.length),r=0;t.blocks.forEach(function(e){n.set(e.header,r),r+=e.headerLength,n.set(e.input,r),r+=e.inputLength}),e.push(n)}),e.push(new Uint8Array(2*i)),new Blob(e,{type:"octet/stream"})},e.prototype.clear=function(){this.written=0,this.out=r.clean(t)},window.Tar=e}(),function(e){function t(e,n){if({}.hasOwnProperty.call(t.cache,e))return t.cache[e];var r=t.resolve(e);if(!r)throw Error("Failed to resolve module "+e);var i={id:e,require:t,filename:e,exports:{},loaded:!1,parent:n,children:[]};n&&n.children.push(i);var a=e.slice(0,e.lastIndexOf("/")+1);return t.cache[e]=i.exports,r.call(i.exports,i,i.exports,a,e),i.loaded=!0,t.cache[e]=i.exports}t.modules={},t.cache={},t.resolve=function(e){return{}.hasOwnProperty.call(t.modules,e)?t.modules[e]:void 0},t.define=function(e,n){t.modules[e]=n};var n=function(t){return t="/",{title:"browser",version:"v0.10.26",browser:!0,env:{},argv:[],nextTick:e.setImmediate||function(e){setTimeout(e,0)},cwd:function(){return t},chdir:function(e){t=e}}}();t.define("/gif.coffee",function(e,n,r,i){function a(e,t){return{}.hasOwnProperty.call(e,t)}function o(e,t){for(var n=0,r=t.length;r>n;++n)if(n in t&&t[n]===e)return!0;return!1}function s(e,t){function n(){this.constructor=e}for(var r in t)a(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e}var h,l,c,u,d;c=t("events",e).EventEmitter,h=t("/browser.coffee",e),d=function(e){function t(e){var t,n;this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(e);for(t in l)n=l[t],null!=this.options[t]?this.options[t]:this.options[t]=n}return s(t,e),l={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null},u={delay:500,copy:!1},t.prototype.setOption=function(e,t){return this.options[e]=t,null==this._canvas||"width"!==e&&"height"!==e?void 0:this._canvas[e]=t},t.prototype.setOptions=function(e){var t,n;return function(r){for(t in e)a(e,t)&&(n=e[t],r.push(this.setOption(t,n)));return r}.call(this,[])},t.prototype.addFrame=function(e,t){var n,r;null==t&&(t={}),(n={}).transparent=this.options.transparent;for(r in u)n[r]=t[r]||u[r];if(null!=this.options.width||this.setOption("width",e.width),null!=this.options.height||this.setOption("height",e.height),"undefined"!=typeof ImageData&&null!=ImageData&&e instanceof ImageData)n.data=e.data;else if("undefined"!=typeof CanvasRenderingContext2D&&null!=CanvasRenderingContext2D&&e instanceof CanvasRenderingContext2D||"undefined"!=typeof WebGLRenderingContext&&null!=WebGLRenderingContext&&e instanceof WebGLRenderingContext)t.copy?n.data=this.getContextData(e):n.context=e;else{if(null==e.childNodes)throw Error("Invalid image");t.copy?n.data=this.getImageData(e):n.image=e}return this.frames.push(n)},t.prototype.render=function(){var e,t;if(this.running)throw Error("Already running");if(null==this.options.width||null==this.options.height)throw Error("Width and height must be set prior to rendering");this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(t){for(var n=function(){var e;e=[];for(var t=0;0>this.frames.length?t>this.frames.length:t<this.frames.length;0>this.frames.length?--t:++t)e.push(t);return e}.apply(this,arguments),r=0,i=n.length;i>r;++r)e=n[r],t.push(null);return t}.call(this,[]),t=this.spawnWorkers();for(var n=function(){var e;e=[];for(var n=0;0>t?n>t:t>n;0>t?--n:++n)e.push(n);return e}.apply(this,arguments),r=0,i=n.length;i>r;++r)e=n[r],this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},t.prototype.abort=function(){for(var e;null!=(e=this.activeWorkers.shift());)console.log("killing active worker"),e.terminate();return this.running=!1,this.emit("abort")},t.prototype.spawnWorkers=function(){var e;return e=Math.min(this.options.workers,this.frames.length),function(){var t;t=[];for(var n=this.freeWorkers.length;this.freeWorkers.length>e?n>e:e>n;this.freeWorkers.length>e?--n:++n)t.push(n);return t}.apply(this,arguments).forEach(function(e){return function(t){var n;return console.log("spawning worker "+t),n=new Worker(e.options.workerScript),n.onmessage=function(e){return function(t){return e.activeWorkers.splice(e.activeWorkers.indexOf(n),1),e.freeWorkers.push(n),e.frameFinished(t.data)}}(e),e.freeWorkers.push(n)}}(this)),e},t.prototype.frameFinished=function(e){return console.log("frame "+e.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[e.index]=e,o(null,this.imageParts)?this.renderNextFrame():this.finishRendering()},t.prototype.finishRendering=function(){var e,t,n,r,i,a,o;i=0;for(var s=0,h=this.imageParts.length;h>s;++s)t=this.imageParts[s],i+=(t.data.length-1)*t.pageSize+t.cursor;i+=t.pageSize-t.cursor,console.log("rendering finished - filesize "+Math.round(i/1e3)+"kb"),e=new Uint8Array(i),a=0;for(var l=0,c=this.imageParts.length;c>l;++l)for(var u=0,d=(t=this.imageParts[l]).data.length;d>u;++u)o=t.data[u],n=u,e.set(o,a),a+=n===t.data.length-1?t.cursor:t.pageSize;return r=new Blob([e],{type:"image/gif"}),this.emit("finished",r,e)},t.prototype.renderNextFrame=function(){var e,t,n;if(0===this.freeWorkers.length)throw Error("No free workers");return this.nextFrame<this.frames.length?(e=this.frames[this.nextFrame++],n=this.freeWorkers.shift(),t=this.getTask(e),console.log("starting frame "+(t.index+1)+" of "+this.frames.length),this.activeWorkers.push(n),n.postMessage(t)):void 0},t.prototype.getContextData=function(e){return e.getImageData(0,0,this.options.width,this.options.height).data},t.prototype.getImageData=function(e){var t;return null!=this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),t=this._canvas.getContext("2d"),t.setFill=this.options.background,t.fillRect(0,0,this.options.width,this.options.height),t.drawImage(e,0,0),this.getContextData(t)},t.prototype.getTask=function(e){var t,n;if(t=this.frames.indexOf(e),n={index:t,last:t===this.frames.length-1,delay:e.delay,transparent:e.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,repeat:this.options.repeat,canTransfer:"chrome"===h.name},null!=e.data)n.data=e.data;else if(null!=e.context)n.data=this.getContextData(e.context);else{if(null==e.image)throw Error("Invalid frame");n.data=this.getImageData(e.image)}return n},t}(c),e.exports=d}),t.define("/browser.coffee",function(e,t,n,r){var i,a,o,s,h;s=navigator.userAgent.toLowerCase(),o=navigator.platform.toLowerCase(),a="ie"===(h=s.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0])[1]&&document.documentMode,(i={name:"version"===h[1]?h[3]:h[1],version:a||parseFloat("opera"===h[1]&&h[4]?h[4]:h[2]),platform:{name:s.match(/ip(?:ad|od|hone)/)?"ios":(s.match(/(?:webos|android)/)||o.match(/mac|win|linux/)||["other"])[0]}})[i.name]=!0,i[i.name+parseInt(i.version,10)]=!0,i.platform[i.platform.name]=!0,e.exports=i}),t.define("events",function(e,t,r,i){n.EventEmitter||(n.EventEmitter=function(){});var a=t.EventEmitter=n.EventEmitter,o="function"==typeof Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};a.prototype.setMaxListeners=function(e){this._events||(this._events={}),this._events.maxListeners=e},a.prototype.emit=function(e){if("error"===e&&(!this._events||!this._events.error||o(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var t=this._events[e];if(!t)return!1;if("function"!=typeof t){if(o(t)){for(var n=Array.prototype.slice.call(arguments,1),r=t.slice(),i=0,a=r.length;a>i;i++)r[i].apply(this,n);return!0}return!1}switch(arguments.length){case 1:t.call(this);break;case 2:t.call(this,arguments[1]);break;case 3:t.call(this,arguments[1],arguments[2]);break;default:n=Array.prototype.slice.call(arguments,1);t.apply(this,n)}return!0},a.prototype.addListener=function(e,t){if("function"!=typeof t)throw Error("addListener only takes instances of Function");if(this._events||(this._events={}),this.emit("newListener",e,t),this._events[e])if(o(this._events[e])){if(!this._events[e].warned){var n;(n=void 0!==this._events.maxListeners?this._events.maxListeners:10)&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace())}this._events[e].push(t)}else this._events[e]=[this._events[e],t];else this._events[e]=t;return this},a.prototype.on=a.prototype.addListener,a.prototype.once=function(e,t){var n=this;return n.on(e,function r(){n.removeListener(e,r),t.apply(this,arguments)}),this},a.prototype.removeListener=function(e,t){if("function"!=typeof t)throw Error("removeListener only takes instances of Function");if(!this._events||!this._events[e])return this;var n=this._events[e];if(o(n)){var r=n.indexOf(t);if(0>r)return this;n.splice(r,1),0==n.length&&delete this._events[e]}else this._events[e]===t&&delete this._events[e];return this},a.prototype.removeAllListeners=function(e){return e&&this._events&&this._events[e]&&(this._events[e]=null),this},a.prototype.listeners=function(e){return this._events||(this._events={}),this._events[e]||(this._events[e]=[]),o(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]}}),e.GIF=t("/gif.coffee")}.call(this,this),function(){"use strict";function t(e){return e&&e.Object===Object?e:null}function n(e){return("0000000"+e).slice(-7)}function r(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function i(e){var t={};this.settings=e,this.on=function(e,n){t[e]=n},this.emit=function(e){var n=t[e];n&&n.apply(null,Array.prototype.slice.call(arguments,1))},this.filename=e.name||r(),this.extension="",this.mimeType=""}function a(e){i.call(this,e),this.extension=".tar",this.mimeType="application/x-tar",this.fileExtension="",this.tape=null,this.count=0}function o(e){a.call(this,e),this.type="image/png",this.fileExtension=".png"}function s(e){a.call(this,e),this.type="image/jpeg",this.fileExtension=".jpg",this.quality=e.quality/100||.8}function h(e){"image/webp"!==document.createElement("canvas").toDataURL("image/webp").substr(5,10)&&console.log("WebP not supported - try another export format"),i.call(this,e),e.quality=e.quality/100||.8,this.extension=".webm",this.mimeType="video/webm",this.baseFilename=this.filename,this.frames=[],this.part=1}function l(e){i.call(this,e),e.quality=e.quality/100||.8,this.encoder=new FFMpegServer.Video(e),this.encoder.on("process",function(){this.emit("process")}.bind(this)),this.encoder.on("finished",function(e,t){var n=this.callback;n&&(this.callback=void 0,n(e,t))}.bind(this)),this.encoder.on("progress",function(e){this.settings.onProgress&&this.settings.onProgress(e)}.bind(this)),this.encoder.on("error",function(e){alert(JSON.stringify(e,null,2))}.bind(this))}function c(e){i.call(this,e),this.framerate=this.settings.framerate,this.type="video/webm",this.extension=".webm",this.stream=null,this.mediaRecorder=null,this.chunks=[]}function u(e){i.call(this,e),e.quality=31-(30*e.quality/100||10),e.workers=e.workers||4,this.extension=".gif",this.mimeType="image/gif",this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.sizeSet=!1,this.encoder=new GIF({workers:e.workers,quality:e.quality,workerScript:e.workersPath+"gif.worker.js"}),this.encoder.on("progress",function(e){this.settings.onProgress&&this.settings.onProgress(e)}.bind(this)),this.encoder.on("finished",function(e){var t=this.callback;t&&(this.callback=void 0,t(e))}.bind(this))}function d(t){function n(){function e(){return this._hooked||(this._hooked=!0,this._hookedTime=this.currentTime||0,this.pause(),te.push(this)),this._hookedTime+I.startTime}b("Capturer start"),M=window.Date.now(),C=M+I.startTime,E=window.performance.now(),D=E+I.startTime,window.Date.prototype.getTime=function(){return C},window.Date.now=function(){return C},window.setTimeout=function(e,t){var n={callback:e,time:t,triggerTime:C+t};return F.push(n),b("Timeout set to "+n.time),n},window.clearTimeout=function(e){for(var t=0;t<F.length;t++)F[t]!=e||(F.splice(t,1),b("Timeout cleared"))},window.setInterval=function(e,t){var n={callback:e,time:t,triggerTime:C+t};return B.push(n),b("Interval set to "+n.time),n},window.clearInterval=function(e){return b("clear Interval"),null},window.requestAnimationFrame=function(e){P.push(e)},window.performance.now=function(){return D};try{Object.defineProperty(HTMLVideoElement.prototype,"currentTime",{get:e}),Object.defineProperty(HTMLAudioElement.prototype,"currentTime",{get:e})}catch(e){b(e)}}function r(){n(),L.start(),W=!0}function i(){W=!1,L.stop(),f()}function a(e,t){J(e,0,t)}function d(){a(w)}function f(){b("Capturer stop"),window.setTimeout=J,window.setInterval=Y,window.clearTimeout=Z,window.requestAnimationFrame=X,window.Date.prototype.getTime=ee,window.Date.now=$,window.performance.now=Q}function p(){var e=R/I.framerate;(I.frameLimit&&R>=I.frameLimit||I.timeLimit&&e>=I.timeLimit)&&(i(),x());var t=new Date(null);t.setSeconds(e),I.motionBlurFrames>2?O.textContent="CCapture "+I.format+" | "+R+" frames ("+z+" inter) | "+t.toISOString().substr(11,8):O.textContent="CCapture "+I.format+" | "+R+" frames | "+t.toISOString().substr(11,8)}function m(e){G.width===e.width&&G.height===e.height||(G.width=e.width,G.height=e.height,U=new Uint16Array(G.height*G.width*4),N.fillStyle="#0",N.fillRect(0,0,G.width,G.height))}function g(e){N.drawImage(e,0,0),q=N.getImageData(0,0,G.width,G.height);for(var t=0;t<U.length;t+=4)U[t]+=q.data[t],U[t+1]+=q.data[t+1],U[t+2]+=q.data[t+2];z++}function y(){for(var e=q.data,t=0;t<U.length;t+=4)e[t]=2*U[t]/I.motionBlurFrames,e[t+1]=2*U[t+1]/I.motionBlurFrames,e[t+2]=2*U[t+2]/I.motionBlurFrames;N.putImageData(q,0,0),L.add(G),z=0,b("Full MB Frame! "+ ++R+" "+C);for(t=0;t<U.length;t+=4)U[t]=0,U[t+1]=0,U[t+2]=0;gc()}function v(e){W&&(I.motionBlurFrames>2?(m(e),g(e),z<.5*I.motionBlurFrames?d():y()):(L.add(e),R++,b("Full Frame! "+R)))}function w(){var e=1e3/I.framerate,t=(R+z/I.motionBlurFrames)*e;C=M+t,D=E+t,te.forEach(function(e){e._hookedTime=t/1e3}),p(),b("Frame: "+R+" "+z);for(n=0;n<F.length;n++)C>=F[n].triggerTime&&(a(F[n].callback),F.splice(n,1));for(var n=0;n<B.length;n++)C>=B[n].triggerTime&&(a(B[n].callback),B[n].triggerTime+=B[n].time);P.forEach(function(e){a(e,C-_)}),P=[]}function x(t){t||(t=function(t){return e(t,L.filename+L.extension,L.mimeType),!1}),L.save(t)}function b(e){A&&console.log(e)}function k(e,t){j[e]=t}function T(e){var t=j[e];t&&t.apply(null,Array.prototype.slice.call(arguments,1))}function S(e){T("progress",e)}var A,C,M,D,E,d,L,I=t||{},F=(new Date,[]),B=[],R=0,z=0,P=[],W=!1,j={};I.framerate=I.framerate||60,I.motionBlurFrames=2*(I.motionBlurFrames||1),A=I.verbose||!1,I.display,I.step=1e3/I.framerate,I.timeLimit=I.timeLimit||0,I.frameLimit=I.frameLimit||0,I.startTime=I.startTime||0;var O=document.createElement("div");O.style.position="absolute",O.style.left=O.style.top=0,O.style.backgroundColor="black",O.style.fontFamily="monospace",O.style.fontSize="11px",O.style.padding="5px",O.style.color="red",O.style.zIndex=1e5,I.display&&document.body.appendChild(O);var U,q,G=document.createElement("canvas"),N=G.getContext("2d");b("Step is set to "+I.step+"ms");var K={gif:u,webm:h,ffmpegserver:l,png:o,jpg:s,"webm-mediarecorder":c},H=K[I.format];if(!H)throw"Error: Incorrect or missing format: Valid formats are "+Object.keys(K).join(", ");if(L=new H(I),L.step=d,L.on("process",w),L.on("progress",S),"performance"in window==0&&(window.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in window.performance==0){var V=Date.now();performance.timing&&performance.timing.navigationStart&&(V=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-V}}var J=window.setTimeout,Y=window.setInterval,Z=window.clearTimeout,X=window.requestAnimationFrame,$=window.Date.now,Q=window.performance.now,ee=window.Date.prototype.getTime,te=[];return{start:r,capture:v,stop:i,save:x,on:k}}var f={function:!0,object:!0},p=(parseFloat,parseInt,f[typeof exports]&&exports&&!exports.nodeType?exports:void 0),m=f[typeof module]&&module&&!module.nodeType?module:void 0,g=m&&m.exports===p?p:void 0,y=t(p&&m&&"object"==typeof global&&global),v=t(f[typeof self]&&self),w=t(f[typeof window]&&window),x=t(f[typeof this]&&this),b=y||w!==(x&&x.window)&&w||v||x||Function("return this")();"gc"in window||(window.gc=function(){}),HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(e,t,n){for(var r=atob(this.toDataURL(t,n).split(",")[1]),i=r.length,a=new Uint8Array(i),o=0;i>o;o++)a[o]=r.charCodeAt(o);e(new Blob([a],{type:t||"image/png"}))}}),function(){if("performance"in window==0&&(window.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in window.performance==0){var e=Date.now();performance.timing&&performance.timing.navigationStart&&(e=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-e}}}();var _=window.Date.now();i.prototype.start=function(){},i.prototype.stop=function(){},i.prototype.add=function(){},i.prototype.save=function(){},i.prototype.dispose=function(){},i.prototype.safeToProceed=function(){return!0},i.prototype.step=function(){console.log("Step not set!")},a.prototype=Object.create(i.prototype),a.prototype.start=function(){this.dispose()},a.prototype.add=function(e){var t=new FileReader;t.onload=function(){this.tape.append(n(this.count)+this.fileExtension,new Uint8Array(t.result)),this.count++,this.step()}.bind(this),t.readAsArrayBuffer(e)},a.prototype.save=function(e){e(this.tape.save())},a.prototype.dispose=function(){this.tape=new Tar,this.count=0},o.prototype=Object.create(a.prototype),o.prototype.add=function(e){e.toBlob(function(e){a.prototype.add.call(this,e)}.bind(this),this.type)},s.prototype=Object.create(a.prototype),s.prototype.add=function(e){e.toBlob(function(e){a.prototype.add.call(this,e)}.bind(this),this.type,this.quality)},h.prototype=Object.create(i.prototype),h.prototype.start=function(e){this.dispose()},h.prototype.add=function(t){this.frames.push(t.toDataURL("image/webp",this.quality)),this.settings.autoSaveTime>0&&this.frames.length/this.settings.framerate>=this.settings.autoSaveTime?this.save(function(t){this.filename=this.baseFilename+"-part-"+n(this.part),e(t,this.filename+this.extension,this.mimeType),this.dispose(),this.part++,this.filename=this.baseFilename+"-part-"+n(this.part),this.step()}.bind(this)):this.step()},h.prototype.save=function(e){if(this.frames.length){var t=Whammy.fromImageArray(this.frames,this.settings.framerate);e(new Blob([t],{type:"octet/stream"}))}},h.prototype.dispose=function(e){this.frames=[]},l.prototype=Object.create(i.prototype),l.prototype.start=function(){this.encoder.start(this.settings)},l.prototype.add=function(e){this.encoder.add(e)},l.prototype.save=function(e){this.callback=e,this.encoder.end()},l.prototype.safeToProceed=function(){return this.encoder.safeToProceed()},c.prototype=Object.create(i.prototype),c.prototype.add=function(e){this.stream||(this.stream=e.captureStream(this.framerate),this.mediaRecorder=new MediaRecorder(this.stream),this.mediaRecorder.start(),this.mediaRecorder.ondataavailable=function(e){this.chunks.push(e.data)}.bind(this)),this.step()},c.prototype.save=function(e){this.mediaRecorder.onstop=function(t){var n=new Blob(this.chunks,{type:"video/webm"});this.chunks=[],e(n)}.bind(this),this.mediaRecorder.stop()},u.prototype=Object.create(i.prototype),u.prototype.add=function(e){this.sizeSet||(this.encoder.setOption("width",e.width),this.encoder.setOption("height",e.height),this.sizeSet=!0),this.canvas.width=e.width,this.canvas.height=e.height,this.ctx.drawImage(e,0,0),this.encoder.addFrame(this.ctx,{copy:!0,delay:this.settings.step}),this.step()},u.prototype.save=function(e){this.callback=e,this.encoder.render()},(w||v||{}).CCapture=d,"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return d}):p&&m?(g&&((m.exports=d).CCapture=d),p.CCapture=d):b.CCapture=d}(),m.assets={song:{rowLen:5513,endPattern:2,songData:[{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:192,osc1_waveform:1,osc2_oct:6,osc2_det:0,osc2_detune:9,osc2_xenv:0,osc2_vol:192,osc2_waveform:1,noise_fader:0,env_attack:137,env_sustain:2e3,env_release:4611,env_master:192,fx_filter:1,fx_freq:982,fx_resonance:89,fx_delay_time:6,fx_delay_amt:25,fx_pan_freq:6,fx_pan_amt:77,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:3,lfo_amt:69,lfo_waveform:0,p:[1],c:[{n:[135,0,0,0,147,0,0,145,0,0,147,0,0,142,0,0,135,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]}],songLen:9}};var l={},c=2,u=33,d=null,f=[t,n,r,i];l.AudioGenerator=function(e){this.mixBuf=e,this.waveSize=e.length/c/2},l.AudioGenerator.prototype.getWave=function(){var e,t,n,r,i,a,o,s=this.mixBuf,h=this.waveSize*c*2;for(a=(i=h-8)-36,r=String.fromCharCode(82,73,70,70,255&i,i>>8&255,i>>16&255,i>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&a,a>>8&255,a>>16&255,a>>24&255),e=0;h>e;){for(n="",t=0;256>t&&h>e;++t,e+=2)o=-32768>(o=4*(s[e]+(s[e+1]<<8)-32768))?-32768:o>32767?32767:o,n+=String.fromCharCode(255&o,o>>8&255);r+=n}return r},l.AudioGenerator.prototype.getAudio=function(){var e=this.getWave(),t=new Audio("data:audio/wav;base64,"+btoa(e));return t.preload="none",t.load(),t},l.AudioGenerator.prototype.getAudioBuffer=function(e){null===d&&(d=new AudioContext);var t=this.mixBuf,n=this.waveSize*c*2,r=d.createBuffer(c,this.waveSize,44100),i=r.getChannelData(0),a=r.getChannelData(1),o=0,s=function(){for(var h=new Date,l=0;n/2>o;){var c=4*(t[4*o]+(t[4*o+1]<<8)-32768);if(c=-32768>c?-32768:c>32767?32767:c,i[o]=c/32768,c=4*(t[4*o+2]+(t[4*o+3]<<8)-32768),c=-32768>c?-32768:c>32767?32767:c,a[o]=c/32768,o+=1,(l+=1)%1e3==0&&new Date-h>u)return void setTimeout(s,0)}setTimeout(function(){e(r)},0)};setTimeout(s,0)},l.SoundGenerator=function(e,t){this.instr=e,this.rowLen=t||5605,this.osc_lfo=f[e.lfo_waveform],this.osc1=f[e.osc1_waveform],this.osc2=f[e.osc2_waveform],this.attack=e.env_attack,this.sustain=e.env_sustain,this.release=e.env_release,this.panFreq=Math.pow(2,e.fx_pan_freq-8)/this.rowLen,this.lfoFreq=Math.pow(2,e.lfo_freq-8)/this.rowLen},l.SoundGenerator.prototype.genSound=function(e,n,r){new Date;for(var i=0,o=0,s=a(e+12*(this.instr.osc1_oct-8)+this.instr.osc1_det)*(1+8e-4*this.instr.osc1_detune),h=a(e+12*(this.instr.osc2_oct-8)+this.instr.osc2_det)*(1+8e-4*this.instr.osc2_detune),l=this.instr.fx_resonance/255,c=0,u=0,d=this.attack+this.sustain+this.release-1;d>=0;--d){var f=d+r,p=this.osc_lfo(f*this.lfoFreq)*this.instr.lfo_amt/512+.5,m=1;d<this.attack?m=d/this.attack:d<this.attack+this.sustain||(m-=(d-this.attack-this.sustain)/this.release);var g=s;this.instr.lfo_osc1_freq&&(g+=p),this.instr.osc1_xenv&&(g*=m*m),i+=g;var y=this.osc1(i)*this.instr.osc1_vol;g=h,this.instr.osc2_xenv&&(g*=m*m),o+=g,y+=this.osc2(o)*this.instr.osc2_vol,this.instr.noise_fader&&(y+=(2*Math.random()-1)*this.instr.noise_fader*m),y*=m/255;var v=this.instr.fx_freq;this.instr.lfo_fx_freq&&(v*=p);var w=l*(y-u)-(c+=(v=1.5*Math.sin(3.141592*v/44100))*u);switch(u+=v*w,this.instr.fx_filter){case 1:y=w;break;case 2:y=c;break;case 3:y=u;break;case 4:y=c+w}if(g=t(f*this.panFreq)*this.instr.fx_pan_amt/512+.5,y*=39*this.instr.env_master,(f*=4)+3<n.length){var x=n[f]+(n[f+1]<<8)+y*(1-g);n[f]=255&x,n[f+1]=x>>8&255,x=n[f+2]+(n[f+3]<<8)+y*g,n[f+2]=255&x,n[f+3]=x>>8&255}}},l.SoundGenerator.prototype.getAudioGenerator=function(e,t){var n=this.attack+this.sustain+this.release-1+32*this.rowLen,r=this;o(n,function(i){r.genSound(e,i,0),s(i,n,r.instr,r.rowLen,function(){t(new l.AudioGenerator(i))})})},l.SoundGenerator.prototype.createAudio=function(e,t){this.getAudioGenerator(e,function(e){t(e.getAudio())})},l.SoundGenerator.prototype.createAudioBuffer=function(e,t){this.getAudioGenerator(e,function(e){e.getAudioBuffer(t)})},l.MusicGenerator=function(e){this.song=e,this.waveSize=44100*e.songLen},l.MusicGenerator.prototype.generateTrack=function(e,t,n){var r=this;o(this.waveSize,function(i){var a=r.waveSize,o=r.waveSize*c*2,h=r.song.rowLen,d=r.song.endPattern,f=new l.SoundGenerator(e,h),p=0,m=0,g=0,y=function(){for(var t=new Date;;)if(32!==g){if(m===d-1)return void setTimeout(v,0);var n=e.p[m];if(n){var r=e.c[n-1].n[g];r&&f.genSound(r,i,p)}if(p+=h,g+=1,new Date-t>u)return void setTimeout(y,0)}else g=0,m+=1},v=function(){s(i,a,e,h,x)},w=0,x=function(){for(var e=new Date,r=0;o>w;){var a=t[w]+(t[w+1]<<8)+i[w]+(i[w+1]<<8)-32768;if(t[w]=255&a,t[w+1]=a>>8&255,w+=2,(r+=1)%1e3==0&&new Date-e>u)return void setTimeout(x,0)}setTimeout(n,0)};setTimeout(y,0)})},l.MusicGenerator.prototype.getAudioGenerator=function(e){var t=this;o(this.waveSize,function(n){var r=0,i=function(){r<t.song.songData.length?(r+=1,t.generateTrack(t.song.songData[r-1],n,i)):e(new l.AudioGenerator(n))};i()})},l.MusicGenerator.prototype.createAudio=function(e){this.getAudioGenerator(function(t){e(t.getAudio())})},l.MusicGenerator.prototype.createAudioBuffer=function(e){this.getAudioGenerator(function(t){t.getAudioBuffer(e)})};var p=function(){function e(e){return r.appendChild(e.dom),e}function t(e){for(var t=0;t<r.children.length;t++)r.children[t].style.display=t===e?"block":"none";n=e}var n=0,r=document.createElement("div");r.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",r.addEventListener("click",function(e){e.preventDefault(),t(++n%r.children.length)},!1);var i=(performance||Date).now(),a=i,o=0,s=e(new p.Panel("FPS","#0ff","#002")),h=e(new p.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var l=e(new p.Panel("MB","#f08","#201"));return t(0),{REVISION:16,dom:r,addPanel:e,showPanel:t,begin:function(){i=(performance||Date).now()},end:function(){o++;var e=(performance||Date).now();if(h.update(e-i,200),e>a+1e3&&(s.update(1e3*o/(e-a),100),a=e,o=0,l)){var t=performance.memory;l.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){i=this.end()},domElement:r,setMode:t}};p.Panel=function(e,t,n){var r=1/0,i=0,a=Math.round,o=a(window.devicePixelRatio||1),s=80*o,h=48*o,l=3*o,c=2*o,u=3*o,d=15*o,f=74*o,p=30*o,m=document.createElement("canvas");m.width=s,m.height=h,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*o+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=n,g.fillRect(0,0,s,h),g.fillStyle=t,g.fillText(e,l,c),g.fillRect(u,d,f,p),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(u,d,f,p),{dom:m,update:function(h,y){r=Math.min(r,h),i=Math.max(i,h),g.fillStyle=n,g.globalAlpha=1,g.fillRect(0,0,s,d),g.fillStyle=t,g.fillText(a(h)+" "+e+" ("+a(r)+"-"+a(i)+")",l,c),g.drawImage(m,u+o,d,f-o,p,u,d,f-o,p),g.fillRect(u+f-o,d,o,p),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(u+f-o,d,o,a((1-h/y)*p))}}},"object"==typeof module&&(module.exports=p),Key={_pressed:{},_released:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,a:65,w:87,s:83,d:68,z:90,x:88,f:70,p:80,r:82,isDown:function(e){return this._pressed[e]},justReleased:function(e){return this._released[e]},onKeydown:function(e){this._pressed[e.keyCode]=!0},onKeyup:function(e){this._released[e.keyCode]=!0,delete this._pressed[e.keyCode]},update:function(){this._released={}}},Txt={textLine:function(e){gl=e.glitch||{};for(var t=e.text.length,n=0;t>n;n++)for(var r=assets.letters[e.text.charAt(n)]||Assets.letters.unknown,i=0;5>i;i++)for(var a=0;5>a;a++)if(1===r[i][a]){var o=(Math.random()<gl.xch||0)*(Math.random()-.5)*gl.xamt||0,s=(Math.random()<gl.ych||0)*(Math.random()-.5)*gl.yamt||0;m.gfx.fillRect(e.x+a*e.scale+o+(5*e.scale+e.hspacing)*n,e.y+i*e.scale+s,e.scale,e.scale)}},text:function(e){var t=5*e.scale,n=e.text.split("\n"),r=n.slice(0),i=n.length,a=r.sort(function(e,t){return t.length-e.length})[0],o=a.length*t+(a.length-1)*e.hspacing,s=i*t+(i-1)*e.vspacing,h=e.x,l=e.y,c=e.x+o,u=e.y+s;"center"==e.halign?(h=e.x-o/2,c=e.x+o/2):"right"==e.halign&&(h=e.x-o,c=e.x),"center"==e.valign?(l=e.y-s/2,u=e.y+s/2):"bottom"==e.valign&&(l=e.y-s,u=e.y);var d=h+o/2,f=l+s/2;if(e.render)for(var p=0;i>p;p++){var m=n[p],g=m.length*t+(m.length-1)*e.hspacing,y=e.x,v=e.y+(t+e.vspacing)*p;"center"==e.halign?y=e.x-g/2:"right"==e.halign&&(y=e.x-g),"center"==e.valign?v-=s/2:"bottom"==e.valign&&(v-=s),e.snap&&(y=Math.floor(y),v=Math.floor(v)),this.textLine({ctx:e.ctx,x:y,y:v,text:m,hspacing:e.hspacing||0,scale:e.scale||1,glitch:e.glitch})}return{sx:h,sy:l,cx:d,cy:f,ex:c,ey:u,width:o,height:s}}},m.game={create:function(){m.sounds={},window.AudioContext=window.AudioContext||window.webkitAudioContext,d=new AudioContext,new l.MusicGenerator(m.assets.song).createAudioBuffer(function(e){m.sounds.song=e}),m.triangles=[];for(var e=0;50>e;e++){let e=255*Math.random()|0,t=255*Math.random()|0;m.triangles.push({x1:e+15*Math.random()*4-15,y1:t+15*Math.random()*4-15,x2:e+15*Math.random()*4-15,y2:t+15*Math.random()*4-15,x3:e+15*Math.random()*4-15,y3:t+15*Math.random()*4-15,color:1+(2*Math.random()|0)})}m.t=0,m.moveX=0,m.renderTarget=m.page2,m.gfx.fillRect(0,0,256,256,1),m.gfx.checker(16,16,2),m.songTrigger=!1,m.cursor={x:0,y:0}},resize:function(){m.canvas.width=window.innerWidth,m.canvas.height=window.innerHeight},step:function(e){m.t+=e,m.cos=Math.cos(e),m.sin=Math.sin(e);for(var t=0;t<m.triangles.length;t++){var n=m.triangles[t],r=n.x1+-128,i=n.x2+-128,a=n.x3+-128,o=n.y1+-128,s=n.y2+-128,h=n.y3+-128;m.triangles[t].x1=m.cos*r-m.sin*o+128,m.triangles[t].y1=m.sin*r+m.cos*o+128,m.triangles[t].x2=m.cos*i-m.sin*s+128,m.triangles[t].y2=m.sin*i+m.cos*s+128,m.triangles[t].x3=m.cos*a-m.sin*h+128,m.triangles[t].y3=m.sin*a+m.cos*h+128}m.player.update(e),Key.isDown(Key.z)&&(m.songTrigger=!0),m.songTrigger&&(m.songTrigger=!1,m.playSound(m.sounds.song,1,1,0))},render:function(e){m.renderTarget=m.screen;for(t=0;t<m.triangles.length;t++)m.gfx.triangle(m.triangles[t].x1,m.triangles[t].y1,m.triangles[t].x2,m.triangles[t].y2,m.triangles[t].x3,m.triangles[t].y3,m.triangles[t].color);m.player.draw();for(var t=4e3;t--;){var n=256*Math.random()|0,r=256*Math.random()|0,i=m.ram[m.screen+(256*r+n)];m.gfx.circle(n,r,1,i-1)}m.render()}},m.player={x:128,y:128,radius:3,xvel:0,yvel:0,speed:6,drag:.97,x1:119,x2:137,x3:128,y1:137,y2:137,y3:119,update:function(e){m.player.x+=e*m.player.xvel,m.player.y+=e*m.player.yvel,m.player.xvel*=m.player.drag,m.player.yvel*=m.player.drag,m.player.x1+=e*m.player.xvel,m.player.x2+=e*m.player.xvel,m.player.x3+=e*m.player.xvel,m.player.y1+=e*m.player.yvel,m.player.y2+=e*m.player.yvel,m.player.y3+=e*m.player.yvel;let t=m.player.x1-m.player.x,n=m.player.x2-m.player.x,r=m.player.x3-m.player.x,i=m.player.y1-m.player.y,a=m.player.y2-m.player.y,o=m.player.y3-m.player.y;m.player.x1=m.cos*t-m.sin*i+m.player.x,m.player.y1=m.sin*t+m.cos*i+m.player.y,m.player.x2=m.cos*n-m.sin*a+m.player.x,m.player.y2=m.sin*n+m.cos*a+m.player.y,m.player.x3=m.cos*r-m.sin*o+m.player.x,m.player.y3=m.sin*r+m.cos*o+m.player.y,Key.isDown(Key.a)&&(m.player.xvel-=m.player.speed),Key.isDown(Key.d)&&(m.player.xvel+=m.player.speed),Key.isDown(Key.w)&&(m.player.yvel-=m.player.speed),Key.isDown(Key.s)&&(m.player.yvel+=m.player.speed),m.player.x>256+2*m.player.radius&&(m.player.x=-m.player.radius),m.player.x<0-2*m.player.radius&&(m.player.x=256+m.player.radius),m.player.y>256+2*m.player.radius&&(m.player.y=-m.player.radius),m.player.y<0-2*m.player.radius&&(m.player.y=256+m.player.radius)},draw:function(e){m.gfx.fillCircle(m.player.x,m.player.y,m.player.radius,4),m.gfx.triangle(m.player.x1,m.player.y1,m.player.x2,m.player.y2,m.player.x3,m.player.y3,m.WHITE)}};var m=ENGINE;init=function(){m.last=0,m.dt=0,m.now=0,stats=new p,document.body.appendChild(stats.dom),m.canvasInit(),m.game.create(),window.addEventListener("keyup",function(e){Key.onKeyup(e)},!1),window.addEventListener("keydown",function(e){Key.onKeydown(e)},!1),window.addEventListener("blur",function(e){paused=!0},!1),window.addEventListener("focus",function(e){paused=!1},!1),window.addEventListener("resize",m.game.resize),h()},window.onload=init()}();
</script></body></html>