<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Game Zero ES6</title><style>
body{margin:0;overflow:hidden;background:#111;color:#ccc}#canvas{position:absolute;top:0;bottom:0;left:0;right:0;width:100%;height:100%;image-rendering:optimizeSpeed;image-rendering:-moz-crisp-edges;image-rendering:-webkit-optimize-contrast;image-rendering:-o-crisp-edges;image-rendering:pixelated;-ms-interpolation-mode:nearest-neighbor;cursor:none;margin:auto}
</style></head><body><canvas id="canvas"></canvas><script>
var GAME=function(){function t(t){return Math.sin(6.283184*t)}function n(e){return 0>t(e)?-1:1}function r(t){return t%1-.5}function i(t){var e=t%1*4;return 2>e?e-1:3-e}function a(t){return.00390625*Math.pow(1.059463094,t-128)}function o(t,e){setTimeout(function(){var n=new Uint8Array(t*u*2),r=n.length-2,i=function(){for(var t=new Date,a=0;r>=0;)if(n[r]=0,n[r+1]=128,r-=2,(a+=1)%1e3==0&&new Date-t>h)return void setTimeout(i,0);setTimeout(function(){e(n)},0)};setTimeout(i,0)},0)}function s(t,e,n,r,i){var a=n.fx_delay_time*r>>1,o=n.fx_delay_amt/255,s=0,c=function(){for(var n=new Date,r=0;e-a>s;){var l=4*s,f=4*(s+a),u=t[f]+(t[f+1]<<8)+(t[l+2]+(t[l+3]<<8)-32768)*o;if(t[f]=255&u,t[f+1]=u>>8&255,u=t[f+2]+(t[f+3]<<8)+(t[l]+(t[l+1]<<8)-32768)*o,t[f+2]=255&u,t[f+3]=u>>8&255,++s,(r+=1)%1e3==0&&new Date-n>h)return void setTimeout(c,0)}setTimeout(i,0)};setTimeout(c,0)}var c={};ENGINE={E:this,screen:0,page1:65536,page2:131072,page3:196608,page4:262144,page5:327680,page6:393216,page7:458752,TRANSPARENT:0,BLACK:1,MAGENTA:2,CYAN:3,WHITE:4,colors:[4278190080,4278190080,4294923775,4294967125,4294967295],palDefault:[0,1,2,3,4],pal:[0,1,2,3,4],renderTarget:0,renderSource:65536,currentState:0,playSound:function(t,e,n,r){var i=d.createBufferSource(),a=d.createGain(),o=d.createStereoPanner();return i.buffer=t,i.connect(o),o.connect(a),a.connect(d.destination),i.playbackRate.value=e,i.loop=r,a.gain.value=1,o.pan.value=n,i.start(),{volume:a,sound:i}},gfx:{clear:function(t){v.ram.fill(t,v.renderTarget,v.renderTarget+65536)},pset:function(t,e,n){e|=0,(t|=0)>-1&&256>t&&e>-1&&256>e&&(v.ram[v.renderTarget+(256*e+t)]=n)},line:function(t,e,n,r,i){var a,o,s=(r|=0)-(e|=0),c=(n|=0)-(t|=0);if(0>s?(s=-s,o=-1):o=1,0>c?(c=-c,a=-1):a=1,s<<=1,c<<=1,this.pset(t,e,i),c>s)for(var l=s-(c>>1);t!=n;)0>l||(e+=o,l-=c),t+=a,l+=s,this.pset(t,e,i);else for(l=c-(s>>1);e!=r;)0>l||(t+=a,l-=s),e+=o,l+=c,this.pset(t,e,i)},circle:function(t,e,n,r){var i=-n,a=0,o=2-2*n;do{this.pset(t-i,e+a,r),this.pset(t-a,e-i,r),this.pset(t+i,e-a,r),this.pset(t+a,e+i,r),(n=o)>a||(o+=2*++a+1),(n>i||o>a)&&(o+=2*++i+1)}while(0>i)},fillCircle:function(t,e,n,r){t|=0,e|=0,r|=0;var i=-(n|=0),a=0,o=2-2*n;do{this.line(t-i,e-a,t+i,e-a,r),this.line(t-i,e+a,t+i,e+a,r),(n=o)>a||(o+=2*++a+1),(n>i||o>a)&&(o+=2*++i+1)}while(0>i)},rect:function(t,e,n,r,i){t|=0,n|=0,e|=0,r|=0,this.line(t,e,n,e,i),this.line(n,e,n,r,i),this.line(t,r,n,r,i),this.line(t,e,t,r,i)},fillRect:function(t,e,n,r,i){t|=0,n|=0,e|=0,r|=0;var a=Math.abs(r-e);if(v.gfx.line(t,e,n,e,i),a>0)for(;--a;)v.gfx.line(t,e+a,n,e+a,i);v.gfx.line(t,r,n,r,i)},triangle:function(t,e,n,r,i,a,o){v.gfx.line(t,e,n,r,o),v.gfx.line(n,r,i,a,o),v.gfx.line(i,a,t,e,o)},fillTriangle:function(t,e,n,r,i,a,o){var t=Math.round(16*t),n=Math.round(16*n),i=Math.round(16*i),e=Math.round(16*e),s=t-n,c=(r=Math.round(16*r))-e,l=n-i,f=(a=Math.round(16*a))-r,u=i-t,h=e-a,d=Math.max(Math.min(t,n,i)+15>>4,0),p=Math.min(Math.max(t,n,i)+15>>4,256),y=Math.max(Math.min(e,r,a)+15>>4,0),g=Math.min(Math.max(e,r,a)+15>>4,256);d&=-8,y&=-8;var x=-c*t-s*e,m=-f*n-l*r,w=-h*i-u*a;(c>0||0==c&&s>0)&&x++,(f>0||0==f&&l>0)&&m++,(h>0||0==h&&u>0)&&w++,x=x-1>>4,m=m-1>>4,w=w-1>>4;var _=0,A=0,S=0,T=0,C=0,E=0;0>s?_-=7*s:A-=7*s,0>c?_-=7*c:A-=7*c,0>l?S-=7*l:T-=7*l,0>f?S-=7*f:T-=7*f,0>u?C-=7*u:E-=7*u,0>h?C-=7*h:E-=7*h;for(var M=y;g>M;M+=8)for(var D=d;p>D;D+=8){var b=x+s*M+c*D,I=m+l*M+f*D,R=w+u*M+h*D;if(!(A>b||T>I||E>R)){var N=D+256*M;if(b<_||I<S||R<C)for(K=0;8>K;K++){for(var G=b,k=I,L=R,P=0;8>P;P++)0>(G|k|L)||(v.ram[v.renderTarget+N]=o),G+=c,k+=f,L+=h,N++;b+=s,I+=l,R+=u,N+=248}else for(var K=0;8>K;K++){for(P=0;8>P;P++,N++)v.ram[v.renderTarget+N]=o;N+=248}}}},spr:function(t=0,e=0,n=16,r=16,i=0,a=0,o=!1,s=!1){for(var c=0;r>c;c++)for(var l=0;n>l;l++)255>a+c&&255>i+l&&a+c>-1&&i+l>-1&&(o&s?v.ram[v.renderSource+(256*(e+(r-c))+t+(n-l))]>0&&(v.ram[v.renderTarget+(256*(a+c)+i+l)]=v.pal[v.ram[v.renderSource+(256*(e+(r-c))+t+(n-l))]]):s&&!o?v.ram[v.renderSource+(256*(e+(r-c))+t+l)]>0&&(v.ram[v.renderTarget+(256*(a+c)+i+l)]=v.ram[v.renderSource+(256*(e+(r-c))+t+l)]):o&&!s?v.ram[v.renderSource+(256*(e+c)+t+(n-l))]>0&&(v.ram[v.renderTarget+(256*(a+c)+i+l)]=v.ram[v.renderSource+(256*(e+c)+t+(n-l))]):o||s||v.ram[v.renderSource+(256*(e+c)+t+l)]>0&&(v.ram[v.renderTarget+(256*(a+c)+i+l)]=v.pal[v.ram[v.renderSource+(256*(e+c)+t+l)]]))},sspr:function(t=0,e=0,n=16,r=16,i=0,a=0,o=16,s=16,c=!1,l=!1){for(var f=n/o,u=r/s,h=0;s>h;h++)for(var d=0;o>d;d++)px=d*f|0,py=h*u|0,255>a+h&&255>i+d&&a+h>-1&&i+d>-1&&v.ram[v.renderSource+(256*(e+py)+t+px)]>0&&(v.ram[v.renderTarget+(256*(a+h)+i+d)]=v.ram[v.renderSource+(256*(e+py)+t+px)])},checker:function(t,e,n){var r=256,i=256,a=0,o=0;t=t||8,r/=e=e||8,i/=t;for(var s=0;t>s;++s)for(var c=0,l=e/2;l>c;++c)a=2*c*r+(s%2?0:r),o=s*i,v.gfx.fillRect(a,o,a+r,o+i,n)}},util:{norm:function(t,e,n){return(t-e)/(n-e)},dist:function(t,e,n,r){if(2===arguments.length)return this.dist(t.x,t.y,e.x,e.y);var i=n-t,a=r-e;return Math.sqrt(i*i+a*a)},polarToPoint:function(t,e){return{x:Math.cos(t)*e,y:Math.sin(t)*e}},pointToPolar:function(t){return{angle:Math.atan2(t.y,t.x),radius:this.magnitude(t)}},magnitude:function(t){return this.dist(0,0,t.x,t.y)},scale:function(t){}},canvasInit:function(){v.canvas=document.getElementById("canvas"),v.ctx=canvas.getContext("2d"),v.canvas.width=window.innerWidth,v.canvas.height=window.innerHeight,v.ctx.imageSmoothingEnabled=!1,v.ctx.mozImageSmoothingEnabled=!1,v.smallcanvas=document.createElement("canvas"),v.smallctx=v.smallcanvas.getContext("2d"),v.smallcanvas.width=256,v.smallcanvas.height=256,v.canvasHeight=v.smallcanvas.height,v.canvasWidth=v.smallcanvas.width,v.imageData=v.smallctx.getImageData(0,0,v.canvasWidth,v.canvasHeight),v.buf=new ArrayBuffer(v.imageData.data.length),v.buf8=new Uint8ClampedArray(v.buf),v.data=new Uint32Array(v.buf),v.ram=new Uint8ClampedArray(524288),v.renderTarget=v.screen},render:function(){for(var t=65536;t--;)v.data[t]=v.colors[v.pal[v.ram[t]]];v.imageData.data.set(v.buf8),v.smallctx.putImageData(v.imageData,0,0),v.compositeSize=window.innerWidth<window.innerHeight?window.innerWidth:window.innerHeight,v.compositeOrigin=(window.innerWidth-v.compositeSize)/2|0,v.ctx.imageSmoothingEnabled=!1,v.ctx.mozImageSmoothingEnabled=!1,v.ctx.drawImage(v.smallcanvas,0,0,255,255,v.compositeOrigin,0,v.compositeSize,v.compositeSize)}};v=ENGINE;Number.prototype.map=function(t,e,n,r){return(this-t)*(r-n)/(e-t)+n};var l={VERSION:"2.3.5",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,PENDING:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(t,e){var n="string"==typeof t.initial?{state:t.initial}:t.initial,r=t.terminal||t.final,i=e||t.target||{},a=t.events||[],o=t.callbacks||{},s={},c={},f=function(t){var e=t.from instanceof Array?t.from:t.from?[t.from]:[l.WILDCARD];s[t.name]=s[t.name]||{};for(var n=0;n<e.length;n++)c[e[n]]=c[e[n]]||[],c[e[n]].push(t.name),s[t.name][e[n]]=t.to||e[n]};n&&(n.event=n.event||"startup",f({name:n.event,from:"none",to:n.state}));for(var u=0;a.length>u;u++)f(a[u]);for(var h in s)s.hasOwnProperty(h)&&(i[h]=l.buildEvent(h,s[h]));for(var h in o)o.hasOwnProperty(h)&&(i[h]=o[h]);return i.current="none",i.is=function(t){return t instanceof Array?t.indexOf(this.current)>=0:this.current===t},i.can=function(t){return!this.transition&&(s[t].hasOwnProperty(this.current)||s[t].hasOwnProperty(l.WILDCARD))},i.cannot=function(t){return!this.can(t)},i.transitions=function(){return c[this.current]},i.isFinished=function(){return this.is(r)},i.error=t.error||function(t,e,n,r,i,a,o){throw o||a},n&&!n.defer&&i[n.event](),i},doCallback:function(t,e,n,r,i,a){if(e)try{return e.apply(t,[n,r,i].concat(a))}catch(e){return t.error(n,r,i,a,l.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",e)}},beforeAnyEvent:function(t,e,n,r,i){return l.doCallback(t,t.onbeforeevent,e,n,r,i)},afterAnyEvent:function(t,e,n,r,i){return l.doCallback(t,t.onafterevent||t.onevent,e,n,r,i)},leaveAnyState:function(t,e,n,r,i){return l.doCallback(t,t.onleavestate,e,n,r,i)},enterAnyState:function(t,e,n,r,i){return l.doCallback(t,t.onenterstate||t.onstate,e,n,r,i)},changeState:function(t,e,n,r,i){return l.doCallback(t,t.onchangestate,e,n,r,i)},beforeThisEvent:function(t,e,n,r,i){return l.doCallback(t,t["onbefore"+e],e,n,r,i)},afterThisEvent:function(t,e,n,r,i){return l.doCallback(t,t["onafter"+e]||t["on"+e],e,n,r,i)},leaveThisState:function(t,e,n,r,i){return l.doCallback(t,t["onleave"+n],e,n,r,i)},enterThisState:function(t,e,n,r,i){return l.doCallback(t,t["onenter"+r]||t["on"+r],e,n,r,i)},beforeEvent:function(t,e,n,r,i){if(!1===l.beforeThisEvent(t,e,n,r,i)||!1===l.beforeAnyEvent(t,e,n,r,i))return!1},afterEvent:function(t,e,n,r,i){l.afterThisEvent(t,e,n,r,i),l.afterAnyEvent(t,e,n,r,i)},leaveState:function(t,e,n,r,i){var a=l.leaveThisState(t,e,n,r,i),o=l.leaveAnyState(t,e,n,r,i);return!1!==a&&!1!==o&&(l.ASYNC===a||l.ASYNC===o?l.ASYNC:void 0)},enterState:function(t,e,n,r,i){l.enterThisState(t,e,n,r,i),l.enterAnyState(t,e,n,r,i)},buildEvent:function(t,e){return function(){var n=this.current,r=e[n]||e[l.WILDCARD]||n,i=Array.prototype.slice.call(arguments);if(this.transition)return this.error(t,n,r,i,l.Error.PENDING_TRANSITION,"event "+t+" inappropriate because previous transition did not complete");if(this.cannot(t))return this.error(t,n,r,i,l.Error.INVALID_TRANSITION,"event "+t+" inappropriate in current state "+this.current);if(!1===l.beforeEvent(this,t,n,r,i))return l.Result.CANCELLED;if(n===r)return l.afterEvent(this,t,n,r,i),l.Result.NOTRANSITION;var a=this;this.transition=function(){return a.transition=null,a.current=r,l.enterState(a,t,n,r,i),l.changeState(a,t,n,r,i),l.afterEvent(a,t,n,r,i),l.Result.SUCCEEDED},this.transition.cancel=function(){a.transition=null,l.afterEvent(a,t,n,r,i)};var o=l.leaveState(this,t,n,r,i);return!1===o?(this.transition=null,l.Result.CANCELLED):l.ASYNC===o?l.Result.PENDING:this.transition?this.transition():void 0}}};v.assets={sounds:{laserOne:{osc1_oct:6,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:192,osc1_waveform:3,osc2_oct:8,osc2_det:0,osc2_detune:0,osc2_xenv:1,osc2_vol:192,osc2_waveform:1,noise_fader:0,env_attack:0,env_sustain:0,env_release:7916,env_master:99,fx_filter:0,fx_freq:11025,fx_resonance:255,fx_delay_time:0,fx_delay_amt:0,fx_pan_freq:0,fx_pan_amt:0,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:4,lfo_amt:27,lfo_waveform:1}},song:{rowLen:5513,endPattern:2,songData:[{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:192,osc1_waveform:1,osc2_oct:6,osc2_det:0,osc2_detune:9,osc2_xenv:0,osc2_vol:192,osc2_waveform:1,noise_fader:0,env_attack:137,env_sustain:2e3,env_release:4611,env_master:192,fx_filter:1,fx_freq:982,fx_resonance:89,fx_delay_time:6,fx_delay_amt:25,fx_pan_freq:6,fx_pan_amt:77,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:3,lfo_amt:69,lfo_waveform:0,p:[1],c:[{n:[135,0,0,0,147,0,0,145,0,0,147,0,0,142,0,0,135,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]}],songLen:9},letters:{"-":[[,,,,0],[,,,,0],[1,1,1,1,1],[,,,,0],[,,,,0]],".":[[,,,,0],[,,,,0],[,,,,0],[,,,,0],[,,1,,0]],1:[[,1,1,,0],[,,1,,0],[,,1,,0],[,,1,,0],[1,1,1,1,1]],2:[[1,1,1,1,0],[,,,,1],[,1,1,1,0],[1,,,,0],[1,1,1,1,1]],3:[[1,1,1,1,0],[,,,,1],[,1,1,1,1],[,,,,1],[1,1,1,1,0]],4:[[1,,,1,0],[1,,,1,0],[1,1,1,1,1],[,,,1,0],[,,,1,0]],5:[[1,1,1,1,1],[1,,,,0],[1,1,1,1,0],[,,,,1],[1,1,1,1,0]],6:[[,1,1,1,0],[1,,,,0],[1,1,1,1,0],[1,,,,1],[,1,1,1,0]],7:[[1,1,1,1,1],[,,,,1],[,,,1,0],[,,1,,0],[,,1,,0]],8:[[,1,1,1,0],[1,,,,1],[,1,1,1,0],[1,,,,1],[,1,1,1,0]],9:[[,1,1,1,0],[1,,,,1],[,1,1,1,1],[,,,,1],[,1,1,1,0]],0:[[,1,1,1,0],[1,,,,1],[1,,,,1],[1,,,,1],[,1,1,1,0]],A:[[1,1,1,1,1],[1,,,,1],[1,1,1,1,1],[1,,,,1],[1,,,,1]],B:[[1,1,1,1,0],[1,,,1,0],[1,1,1,1,1],[1,,,,1],[1,1,1,1,1]],C:[[1,1,1,1,1],[1,,,,0],[1,,,,0],[1,,,,0],[1,1,1,1,1]],D:[[1,1,1,,0],[1,,,1,0],[1,,,,1],[1,,,,1],[1,1,1,1,1]],E:[[1,1,1,1,1],[1,,,,0],[1,1,1,,0],[1,,,,0],[1,1,1,1,1]],F:[[1,1,1,1,1],[1,,,,0],[1,1,1,,0],[1,,,,0],[1,,,,0]],G:[[1,1,1,1,1],[1,,,,0],[1,,1,1,1],[1,,,,1],[1,1,1,1,1]],H:[[1,,,,1],[1,,,,1],[1,1,1,1,1],[1,,,,1],[1,,,,1]],I:[[1,1,1,1,1],[,,1,,0],[,,1,,0],[,,1,,0],[1,1,1,1,1]],J:[[,,,,1],[,,,,1],[,,,,1],[1,,,,1],[1,1,1,1,1]],K:[[1,,,1,0],[1,,1,,0],[1,1,1,,0],[1,,,1,0],[1,,,,1]],L:[[1,,,,0],[1,,,,0],[1,,,,0],[1,,,,0],[1,1,1,1,1]],M:[[1,,,,1],[1,1,,1,1],[1,,1,,1],[1,,,,1],[1,,,,1]],N:[[1,,,,1],[1,1,,,1],[1,,1,,1],[1,,,1,1],[1,,,,1]],O:[[1,1,1,1,1],[1,,,,1],[1,,,,1],[1,,,,1],[1,1,1,1,1]],P:[[1,1,1,1,1],[1,,,,1],[1,1,1,1,1],[1,,,,0],[1,,,,0]],Q:[[1,1,1,1,0],[1,,,1,0],[1,,,1,0],[1,,,1,0],[1,1,1,1,1]],R:[[1,1,1,1,1],[1,,,,1],[1,1,1,1,1],[1,,,1,0],[1,,,,1]],S:[[1,1,1,1,1],[1,,,,0],[1,1,1,1,1],[,,,,1],[1,1,1,1,1]],T:[[1,1,1,1,1],[,,1,,0],[,,1,,0],[,,1,,0],[,,1,,0]],U:[[1,,,,1],[1,,,,1],[1,,,,1],[1,,,,1],[1,1,1,1,1]],V:[[1,,,,1],[1,,,,1],[1,,,,1],[,1,,1,0],[,,1,,0]],W:[[1,,,,1],[1,,,,1],[1,,1,,1],[1,1,,1,1],[1,,,,1]],X:[[1,,,,1],[,1,,1,0],[,,1,,0],[,1,,1,0],[1,,,,1]],Y:[[1,,,,1],[1,,,,1],[1,1,1,1,1],[,,1,,0],[,,1,,0]],Z:[[1,1,1,1,1],[,,,1,0],[,,1,,0],[,1,,,0],[1,1,1,1,1]]," ":[[,,,,0],[,,,,0],[,,,,0],[,,,,0],[,,,,0]],",":[[,,,,0],[,,,,0],[,,,,0],[,,1,,0],[,,1,,0]],"+":[[,,,,0],[,,1,,0],[,1,1,1,0],[,,1,,0],[,,,,0]],"/":[[,,,,1],[,,,1,0],[,,1,,0],[,1,,,0],[1,,,,0]],":":[[,,,,0],[,,1,,0],[,,,,0],[,,1,,0],[,,,,0]],"@":[[1,1,1,1,1],[,,,,1],[1,1,1,,1],[1,,1,,1],[1,1,1,1,1]],x:[[1,,1,,1],[,1,,1,0],[1,,1,,1],[,1,,1,0],[1,,1,,1]],z:[[,1,,1,0],[1,,1,,1],[,1,,1,0],[1,,1,,1],[,1,,1,0]],o:[[1,1,1,1,1],[1,,,,1],[1,,1,,1],[1,,,,1],[1,1,1,1,1]],e:[[1,,,,0],[1,1,,,0],[1,1,1,,0],[1,1,1,1,0],[1,1,1,1,1]],w:[[,,,,1],[,,,1,1],[,,1,1,1],[,1,1,1,1],[1,1,1,1,1]],s:[[1,1,1,1,1],[,1,1,1,1],[,,1,1,1],[,,,1,1],[,,,,1]],d:[[1,1,1,1,1],[1,1,1,1,0],[1,1,1,,0],[1,1,,,0],[1,,,,0]],t:[[0,0,0,1,1],[0,0,1,1,1],[0,0,1,1,1],[0,0,1,1,1],[0,0,1,1,1]],y:[[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1]],u:[[1,1,0,0,0],[1,1,1,0,0],[0,0,1,0,0],[0,1,1,0,0],[1,1,1,0,0]],g:[[0,0,1,1,1],[0,0,0,1,1],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,1]],h:[[1,1,1,1,1],[1,1,1,1,1],[0,1,1,1,0],[1,1,1,1,1],[1,1,1,1,1]],j:[[1,1,1,0,0],[1,1,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[1,1,1,1,1]],b:[[0,0,0,1,1],[0,0,0,1,1],[0,0,0,0,1],[0,0,0,0,1],[0,0,0,0,1]],n:[[1,1,1,1,1],[1,1,1,1,1],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],a:[[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1]]}},Entity=function(t){t||(t={radius:10,gravity:0,frictX:.92,frictY:.94}),this.cx=0,this.cy=0,this.xr=0,this.yr=0,this.xx=0,this.yy=0,this.dx=0,this.dy=0,this.collided=!1,this.ox=0,this.oy=0,this.radius=t.radius||10,this.gravity=t.gravity||0,this.bounce=t.bounce||0,this.frictX=t.frictX||.92,this.frictY=t.frictY||.94,this.dead=!1,this.collides=t.collides||0,this.mapcollide=t.mapcollide||0,this.id=Math.random()},Entity.prototype.setCoords=function(t,e){this.xx=t,this.yy=e,this.cx=Math.floor(this.xx/Const.GRID),this.cy=Math.floor(this.yy/Const.GRID),this.xr=(this.xx-this.cx*Const.GRID)/Const.GRID,this.yr=(this.yy-this.cy*Const.GRID)/Const.GRID},Entity.prototype.hasCollision=function(t,e){return!!this.mapcollide&&(void 0!=Assets.map[e]&&void 0!=Assets.map[e][t]&&Assets.map[e][t])},Entity.prototype.overlaps=function(t,e){var n=t.radius+e.radius;return(e.xx-t.xx)*(e.xx-t.xx)+(e.yy-t.yy)*(e.yy-t.yy)<=n*n},Entity.prototype.onGround=function(){return this.hasCollision(this.cx,this.cy+1)&&this.yr>=.5},Entity.prototype.onCeiling=function(){return this.hasCollision(this.cx,this.cy-1)&&.5>=this.yr},Entity.prototype.onWallLeft=function(){return this.hasCollision(this.cx-1,this.cy)&&.5>=this.xr},Entity.prototype.onWallRight=function(){return this.hasCollision(this.cx+1,this.cy)&&this.xr>=.5},Entity.prototype.update=function(){for(this.xr+=this.dx,this.dx*=this.frictX,this.hasCollision(this.cx-1,this.cy)&&.3>=this.xr&&(this.dx=0,this.xr=.3),this.hasCollision(this.cx+1,this.cy)&&this.xr>=.7&&(this.dx=0,this.xr=.7);0>this.xr;)this.cx--,this.xr++;for(;this.xr>1;)this.cx++,this.xr--;for(this.dy+=this.gravity,this.yr+=this.dy,this.dy*=this.frictY,this.hasCollision(this.cx,this.cy-1)&&.4>=this.yr&&(this.dy=0,this.yr=.4),this.hasCollision(this.cx,this.cy+1)&&this.yr>=.7&&(this.dy=this.bounce?-this.dy:0,this.bounce||(this.yr=.7));0>this.yr;)this.cy--,this.yr++;for(;this.yr>1;)this.cy++,this.yr--;this.xx=Math.floor((this.cx+this.xr)*Const.GRID),this.yy=Math.floor((this.cy+this.yr)*Const.GRID),this.ox=(this.cx+this.xr)*Const.GRID,this.oy=(this.cy+this.yr)*Const.GRID},Entity.prototype.collide=function(t,n){var r=Math.sqrt((t.xx-n.xx)*(t.xx-n.xx)+(t.yy-n.yy)*(t.yy-n.yy));if(r<=t.radius+n.radius){this.collided=!0;var i=Math.atan2(t.yy-n.yy,t.xx-n.xx),a=(n.radius+t.radius-r)/(n.radius+t.radius);this.dx-=Math.cos(i)*a*.03,this.dy-=Math.sin(i)*a*.03,e.dx+=Math.cos(i)*a*.03,e.dy+=Math.sin(i)*a*.03}};var f={},u=2,h=33,d=null,p=[t,n,r,i];f.AudioGenerator=function(t){this.mixBuf=t,this.waveSize=t.length/u/2},f.AudioGenerator.prototype.getWave=function(){var t,e,n,r,i,a,o,s=this.mixBuf,c=this.waveSize*u*2;for(a=(i=c-8)-36,r=String.fromCharCode(82,73,70,70,255&i,i>>8&255,i>>16&255,i>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&a,a>>8&255,a>>16&255,a>>24&255),t=0;c>t;){for(n="",e=0;256>e&&c>t;++e,t+=2)o=-32768>(o=4*(s[t]+(s[t+1]<<8)-32768))?-32768:o>32767?32767:o,n+=String.fromCharCode(255&o,o>>8&255);r+=n}return r},f.AudioGenerator.prototype.getAudio=function(){var t=this.getWave(),e=new Audio("data:audio/wav;base64,"+btoa(t));return e.preload="none",e.load(),e},f.AudioGenerator.prototype.getAudioBuffer=function(t){null===d&&(d=new AudioContext);var e=this.mixBuf,n=this.waveSize*u*2,r=d.createBuffer(u,this.waveSize,44100),i=r.getChannelData(0),a=r.getChannelData(1),o=0,s=function(){for(var c=new Date,l=0;n/2>o;){var f=4*(e[4*o]+(e[4*o+1]<<8)-32768);if(f=-32768>f?-32768:f>32767?32767:f,i[o]=f/32768,f=4*(e[4*o+2]+(e[4*o+3]<<8)-32768),f=-32768>f?-32768:f>32767?32767:f,a[o]=f/32768,o+=1,(l+=1)%1e3==0&&new Date-c>h)return void setTimeout(s,0)}setTimeout(function(){t(r)},0)};setTimeout(s,0)},f.SoundGenerator=function(t,e){this.instr=t,this.rowLen=e||5605,this.osc_lfo=p[t.lfo_waveform],this.osc1=p[t.osc1_waveform],this.osc2=p[t.osc2_waveform],this.attack=t.env_attack,this.sustain=t.env_sustain,this.release=t.env_release,this.panFreq=Math.pow(2,t.fx_pan_freq-8)/this.rowLen,this.lfoFreq=Math.pow(2,t.lfo_freq-8)/this.rowLen},f.SoundGenerator.prototype.genSound=function(e,n,r){new Date;for(var i=0,o=0,s=a(e+12*(this.instr.osc1_oct-8)+this.instr.osc1_det)*(1+8e-4*this.instr.osc1_detune),c=a(e+12*(this.instr.osc2_oct-8)+this.instr.osc2_det)*(1+8e-4*this.instr.osc2_detune),l=this.instr.fx_resonance/255,f=0,u=0,h=this.attack+this.sustain+this.release-1;h>=0;--h){var d=h+r,p=this.osc_lfo(d*this.lfoFreq)*this.instr.lfo_amt/512+.5,y=1;h<this.attack?y=h/this.attack:h<this.attack+this.sustain||(y-=(h-this.attack-this.sustain)/this.release);var v=s;this.instr.lfo_osc1_freq&&(v+=p),this.instr.osc1_xenv&&(v*=y*y),i+=v;var g=this.osc1(i)*this.instr.osc1_vol;v=c,this.instr.osc2_xenv&&(v*=y*y),o+=v,g+=this.osc2(o)*this.instr.osc2_vol,this.instr.noise_fader&&(g+=(2*Math.random()-1)*this.instr.noise_fader*y),g*=y/255;var x=this.instr.fx_freq;this.instr.lfo_fx_freq&&(x*=p);var m=l*(g-u)-(f+=(x=1.5*Math.sin(3.141592*x/44100))*u);switch(u+=x*m,this.instr.fx_filter){case 1:g=m;break;case 2:g=f;break;case 3:g=u;break;case 4:g=f+m}if(v=t(d*this.panFreq)*this.instr.fx_pan_amt/512+.5,g*=39*this.instr.env_master,(d*=4)+3<n.length){var w=n[d]+(n[d+1]<<8)+g*(1-v);n[d]=255&w,n[d+1]=w>>8&255,w=n[d+2]+(n[d+3]<<8)+g*v,n[d+2]=255&w,n[d+3]=w>>8&255}}},f.SoundGenerator.prototype.getAudioGenerator=function(t,e){var n=this.attack+this.sustain+this.release-1+32*this.rowLen,r=this;o(n,function(i){r.genSound(t,i,0),s(i,n,r.instr,r.rowLen,function(){e(new f.AudioGenerator(i))})})},f.SoundGenerator.prototype.createAudio=function(t,e){this.getAudioGenerator(t,function(t){e(t.getAudio())})},f.SoundGenerator.prototype.createAudioBuffer=function(t,e){this.getAudioGenerator(t,function(t){t.getAudioBuffer(e)})},f.MusicGenerator=function(t){this.song=t,this.waveSize=44100*t.songLen},f.MusicGenerator.prototype.generateTrack=function(t,e,n){var r=this;o(this.waveSize,function(i){var a=r.waveSize,o=r.waveSize*u*2,c=r.song.rowLen,l=r.song.endPattern,d=new f.SoundGenerator(t,c),p=0,y=0,v=0,g=function(){for(var e=new Date;;)if(32!==v){if(y===l-1)return void setTimeout(x,0);var n=t.p[y];if(n){var r=t.c[n-1].n[v];r&&d.genSound(r,i,p)}if(p+=c,v+=1,new Date-e>h)return void setTimeout(g,0)}else v=0,y+=1},x=function(){s(i,a,t,c,w)},m=0,w=function(){for(var t=new Date,r=0;o>m;){var a=e[m]+(e[m+1]<<8)+i[m]+(i[m+1]<<8)-32768;if(e[m]=255&a,e[m+1]=a>>8&255,m+=2,(r+=1)%1e3==0&&new Date-t>h)return void setTimeout(w,0)}setTimeout(n,0)};setTimeout(g,0)})},f.MusicGenerator.prototype.getAudioGenerator=function(t){var e=this;o(this.waveSize,function(n){var r=0,i=function(){r<e.song.songData.length?(r+=1,e.generateTrack(e.song.songData[r-1],n,i)):t(new f.AudioGenerator(n))};i()})},f.MusicGenerator.prototype.createAudio=function(t){this.getAudioGenerator(function(e){t(e.getAudio())})},f.MusicGenerator.prototype.createAudioBuffer=function(t){this.getAudioGenerator(function(e){e.getAudioBuffer(t)})};var y=function(){function t(t){return r.appendChild(t.dom),t}function e(t){for(var e=0;e<r.children.length;e++)r.children[e].style.display=e===t?"block":"none";n=t}var n=0,r=document.createElement("div");r.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",r.addEventListener("click",function(t){t.preventDefault(),e(++n%r.children.length)},!1);var i=(performance||Date).now(),a=i,o=0,s=t(new y.Panel("FPS","#0ff","#002")),c=t(new y.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var l=t(new y.Panel("MB","#f08","#201"));return e(0),{REVISION:16,dom:r,addPanel:t,showPanel:e,begin:function(){i=(performance||Date).now()},end:function(){o++;var t=(performance||Date).now();if(c.update(t-i,200),t>a+1e3&&(s.update(1e3*o/(t-a),100),a=t,o=0,l)){var e=performance.memory;l.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){i=this.end()},domElement:r,setMode:e}};y.Panel=function(t,e,n){var r=1/0,i=0,a=Math.round,o=a(window.devicePixelRatio||1),s=80*o,c=48*o,l=3*o,f=2*o,u=3*o,h=15*o,d=74*o,p=30*o,y=document.createElement("canvas");y.width=s,y.height=c,y.style.cssText="width:80px;height:48px";var v=y.getContext("2d");return v.font="bold "+9*o+"px Helvetica,Arial,sans-serif",v.textBaseline="top",v.fillStyle=n,v.fillRect(0,0,s,c),v.fillStyle=e,v.fillText(t,l,f),v.fillRect(u,h,d,p),v.fillStyle=n,v.globalAlpha=.9,v.fillRect(u,h,d,p),{dom:y,update:function(c,g){r=Math.min(r,c),i=Math.max(i,c),v.fillStyle=n,v.globalAlpha=1,v.fillRect(0,0,s,h),v.fillStyle=e,v.fillText(a(c)+" "+t+" ("+a(r)+"-"+a(i)+")",l,f),v.drawImage(y,u+o,h,d-o,p,u,h,d-o,p),v.fillRect(u+d-o,h,o,p),v.fillStyle=n,v.globalAlpha=.9,v.fillRect(u+d-o,h,o,a((1-c/g)*p))}}},"object"==typeof module&&(module.exports=y),Key={_pressed:{},_released:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,a:65,w:87,s:83,d:68,z:90,x:88,f:70,p:80,r:82,isDown:function(t){return this._pressed[t]},justReleased:function(t){return this._released[t]},onKeydown:function(t){this._pressed[t.keyCode]=!0},onKeyup:function(t){this._released[t.keyCode]=!0,delete this._pressed[t.keyCode]},update:function(){this._released={}}},Txt={textLine:function(t){for(var e=t.text.length,n=0;e>n;n++)for(var r=v.assets.letters[t.text.charAt(n)]||v.assets.letters.unknown,i=0;5>i;i++)for(var a=0;5>a;a++)1===r[i][a]&&(1===t.scale?v.gfx.pset(t.x+a*t.scale+(5*t.scale+t.hspacing)*n,t.y+i*t.scale,t.color):v.gfx.fillRect(t.x+a*t.scale+(5*t.scale+t.hspacing)*n,t.y+i*t.scale,t.x+a*t.scale+(5*t.scale+t.hspacing)*n+t.scale,t.y+i*t.scale+t.scale,t.color))},text:function(t){var e=5*t.scale,n=t.text.split("\n"),r=n.slice(0),i=n.length,a=r.sort(function(t,e){return e.length-t.length})[0],o=a.length*e+(a.length-1)*t.hspacing,s=i*e+(i-1)*t.vspacing,c=t.x,l=t.y,f=t.x+o,u=t.y+s;"center"==t.halign?(c=t.x-o/2,f=t.x+o/2):"right"==t.halign&&(c=t.x-o,f=t.x),"center"==t.valign?(l=t.y-s/2,u=t.y+s/2):"bottom"==t.valign&&(l=t.y-s,u=t.y);var h=c+o/2,d=l+s/2;if(t.render)for(var p=0;i>p;p++){var y=n[p],v=y.length*e+(y.length-1)*t.hspacing,g=t.x,x=t.y+(e+t.vspacing)*p;"center"==t.halign?g=t.x-v/2:"right"==t.halign&&(g=t.x-v),"center"==t.valign?x-=s/2:"bottom"==t.valign&&(x-=s),t.snap&&(g=Math.floor(g),x=Math.floor(x)),this.textLine({ctx:t.ctx,x:g,y:x,text:y,hspacing:t.hspacing||0,scale:t.scale||1,color:t.color})}return{sx:c,sy:l,cx:h,cy:d,ex:f,ey:u,width:o,height:s}}},c.boot={onenter:function(t,e,n){v.sounds={},window.AudioContext=window.AudioContext||window.webkitAudioContext,d=new AudioContext,new f.MusicGenerator(v.assets.song).createAudioBuffer(function(t){v.sounds.song=t}),v.stars=[];for(var r=0;300>r;r++)v.stars.push({x:256*Math.random(),y:256*Math.random(),speed:6*Math.random()});v.t=0,v.moveX=0,v.speedFactor=.6,v.songTrigger=!1},onexit:function(t,e,n){},step:function(t){Key.isDown(Key.p)&&"boot"==fsm.current&&fsm.ready()},render:function(t){v.gfx.fillRect(0,0,256,256,0),v.gfx.fillRect(0,0,64,64,2),Txt.text({x:128,y:40+15*Math.sin(2.5*v.t),text:"BOOT",hspacing:8+4*Math.cos(2.9*v.t),vspacing:15+5*Math.sin(3.5*v.t),halign:"center",valign:"top",scale:10,snap:1,render:1,color:v.WHITE})}},c.gameover={onenter:function(t,e,n){},onexit:function(t,e,n){},step:function(t){},render:function(t){v.gfx.fillRect(0,0,256,256,0),v.gfx.fillRect(0,0,64,64,2),Txt.text({x:128,y:40+15*Math.sin(2.5*v.t),text:"GAME/nOVER",hspacing:8+4*Math.cos(2.9*v.t),vspacing:15+5*Math.sin(3.5*v.t),halign:"center",valign:"top",scale:10,snap:1,render:1,color:v.WHITE})}},c.menu={onenter:function(t,e,n){},onexit:function(t,e,n){},step:function(t){Key.isDown(Key.r)&&fsm.play()},render:function(t){v.gfx.fillRect(0,0,256,256,0),v.gfx.fillRect(0,0,64,64,2),Txt.text({x:128,y:40+15*Math.sin(2.5*v.t),text:"MENU",hspacing:8+4*Math.cos(2.9*v.t),vspacing:15+5*Math.sin(3.5*v.t),halign:"center",valign:"top",scale:10,snap:1,render:1,color:v.WHITE})}},c.game={onenter:function(){v.sounds={},window.AudioContext=window.AudioContext||window.webkitAudioContext,d=new AudioContext,new f.MusicGenerator(v.assets.song).createAudioBuffer(function(t){v.sounds.song=t}),v.stars=[];for(var t=0;300>t;t++)v.stars.push({x:256*Math.random(),y:256*Math.random(),speed:6*Math.random()});v.moveX=0,v.speedFactor=.6,v.songTrigger=!1},step:function(t){v.cos=Math.cos(t),v.sin=Math.sin(t);for(var e=0;e<v.stars.length;e++)v.stars[e].y+=v.stars[e].speed*v.speedFactor,v.stars[e].y>256&&(v.stars[e].y=0,v.stars[e].x=256*Math.random());v.player.update(t),Key.isDown(Key.z)&&(v.songTrigger=!0),v.songTrigger&&(v.songTrigger=!1,v.playSound(v.sounds.song,1,1,0))},render:function(t){v.renderTarget=v.page1,v.gfx.fillRect(0,0,256,256,0);for(let t=0;t<v.stars.length;t++){let e=1.40625*v.stars[t].x*.0174533,n=v.stars[t].y/2,r=v.util.polarToPoint(e,n);v.gfx.pset(r.x+128,r.y+128,v.MAGENTA)}v.player.draw(),v.gfx.circle(128,128,127,v.WHITE),v.renderTarget=v.page3;for(var e=2e3;e--;){var n=256*Math.random()|0,r=256*Math.random()|0,i=v.ram[v.page1+(256*r+n)];v.gfx.circle(n,r,1,i-1)}v.renderTarget=v.page2,v.gfx.fillRect(0,0,256,256,0),Txt.text({x:8,y:240,text:"X: "+(""+v.player.x).substring(0,7)+"\nY: "+(""+v.player.y).substring(0,7),hspacing:2,vspacing:2,halign:"left",valign:"top",scale:1,snap:1,render:1,color:v.CYAN}),v.renderSource=v.page3,v.renderTarget=v.screen,v.gfx.fillRect(0,0,256,256,1),v.gfx.spr(0,0,256,256),v.renderSource=v.page1,v.renderTarget=v.screen,v.gfx.spr(0,0,256,256),v.renderSource=v.page2,v.renderTarget=v.screen,v.gfx.spr(0,0,256,256),v.render()}},v.player={x:128,y:230,radius:7,xvel:0,yvel:0,speed:6,drag:.97,update:function(t){let e=t*v.player.xvel*v.player.drag,n=t*v.player.yvel*v.player.drag;v.player.x+=e,v.player.y+=n,Key.isDown(Key.a)&&(v.player.xvel-=v.player.speed),Key.isDown(Key.d)&&(v.player.xvel+=v.player.speed),Key.isDown(Key.w)&&(v.player.yvel-=v.player.speed),Key.isDown(Key.s)&&(v.player.yvel+=v.player.speed),Key.isDown(Key.SPACE),v.player.x>256&&(v.player.x=0),0>v.player.x&&(v.player.x=256),v.player.y>256&&(v.player.y=0),0>v.player.y&&(v.player.y=256)},draw:function(t){let e=1.40625*v.player.x*.0174533,n=v.player.y/2,r=v.util.polarToPoint(e,n),i=v.util.dist(r.x+128,r.y+128,128,128),a=v.util.norm(i,0,128);v.gfx.fillCircle(r.x+128,r.y+128,v.player.radius*a,4)}};var v=ENGINE;init=function(){v.last=0,v.dt=0,v.now=0,v.t=0,stats=new y,document.body.appendChild(stats.dom),v.canvasInit(),fsm=l.create({initial:"init",events:[{name:"load",from:"init",to:"boot"},{name:"ready",from:"boot",to:"menu"},{name:"play",from:["menu","gameover"],to:"game"},{name:"lose",from:["game","gameover"],to:"gameover"},{name:"reset",from:["init","boot","menu","gameover","game"],to:"boot"}],callbacks:{onenterboot:function(t,e,n){c.boot.onenter(t,e,n)},onentermenu:function(t,e,n){c.menu.onenter(t,e,n)},onleavemenu:function(t,e,n){c.menu.onexit(t,e,n)},onentergame:function(t,e,n){c.game.onenter(t,e,n)},onleavegame:function(t,e,n){c.game.onexit(t,e,n)},onentergameover:function(t,e,n){c.gameover.onenter(t,e,n)}}}),window.addEventListener("keyup",function(t){Key.onKeyup(t)},!1),window.addEventListener("keydown",function(t){Key.onKeydown(t)},!1),window.addEventListener("blur",function(t){paused=!0},!1),window.addEventListener("focus",function(t){paused=!1},!1),window.addEventListener("resize",function(){v.canvas.width=window.innerWidth,v.canvas.height=window.innerHeight}),fsm.load(),loop()},loop=function(){stats.begin();let t=(new Date).getTime();v.dt=Math.min(1,(t-v.last)/1e3),v.t+=v.dt,c[fsm.current].render(),c[fsm.current].step(v.dt),v.last=t,v.render(),stats.end(),requestAnimationFrame(loop)},window.onload=init()}();
</script></body></html>